<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QuickPoster — Canva-style Poster Creator</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{margin:0;font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#e6f4ff,#cdb3ff);}
.header{padding:18px;text-align:center;color:#fff;background:linear-gradient(90deg,#6dd5fa,#8e54e9);font-weight:800;border-bottom-left-radius:8px;border-bottom-right-radius:8px;}
.container{display:flex;flex-wrap:wrap;gap:18px;max-width:1200px;margin:18px auto;padding:10px;}
.panel{background:#fffdf8;border-radius:12px;padding:14px;box-shadow:0 8px 30px rgba(12,18,30,0.08);}
.left{flex:1;min-width:300px;}
.right{flex:2;min-width:400px;display:flex;flex-direction:column;align-items:center;}
.label{display:block;margin-top:10px;color:#6b6b6b;font-weight:600;}
input,select,textarea{width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid #e8e8e8;font-size:14px;}
textarea{resize:vertical;}
.btn{display:inline-block;padding:8px 12px;border-radius:8px;background:#d84f6b;color:#fff;border:none;cursor:pointer;font-weight:700;margin-top:6px;}
.preview-canvas{width:595px;height:842px;background:#fffdf8;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.08);position:relative;overflow:hidden;margin-top:12px;}
.element{position:absolute;cursor:move;user-select:none;display:flex;align-items:center;justify-content:center;}
.text-element{font-family:'Playfair Display',serif;font-weight:700;color:#d84f6b;text-align:center;padding:4px;min-width:50px;min-height:20px;}
.image-element{max-width:100%;max-height:100%;pointer-events:auto;}
.selected{outline:2px dashed #6dd5fa;}
.resize-handle{width:10px;height:10px;background:#6dd5fa;position:absolute;right:0;bottom:0;cursor:se-resize;border-radius:2px;}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;}
.color-picker{width:100%;height:28px;border:none;margin-top:6px;}
.page-tabs{display:flex;gap:6px;margin-top:12px;flex-wrap:wrap;}
.page-tab{padding:4px 10px;background:#eee;border-radius:6px;cursor:pointer;}
.page-tab.active{background:#d84f6b;color:#fff;}
.sticker-btn{font-size:12px;padding:4px 6px;background:#eee;color:#111;border-radius:6px;cursor:pointer;}
.sticker-btn:hover{background:#d84f6b;color:#fff;}
</style>
</head>
<body>
<div class="header">QuickPoster — Canva-style Poster Creator</div>

<div class="container">
  <div class="panel left">
    <label class="label">Poster Type</label>
    <select id="templateSelect">
      <option value="wedding">Wedding Program</option>
      <option value="obituary">Obituary / Funeral</option>
      <option value="event">Event / Gathering</option>
      <option value="menu">Restaurant Menu</option>
    </select>

    <div class="controls">
      <button id="addText" class="btn">Add Text</button>
      <button id="addImage" class="btn">Add Image</button>
    </div>

    <div class="controls">
      <button id="bringFront" class="btn">Bring Forward</button>
      <button id="sendBack" class="btn">Send Back</button>
      <button id="deleteElement" class="btn">Delete Element</button>
    </div>

    <label class="label">Text Options</label>
    <input type="color" id="textColor" class="color-picker" value="#d84f6b">
    <select id="fontSizeSelect" class="controls">
      <option value="16">16px</option>
      <option value="20">20px</option>
      <option value="24" selected>24px</option>
      <option value="30">30px</option>
      <option value="36">36px</option>
      <option value="48">48px</option>
    </select>
    <select id="fontFamilySelect" class="controls">
      <option value="'Playfair Display', serif" selected>Playfair Display</option>
      <option value="'Poppins', sans-serif">Poppins</option>
      <option value="'Arial', sans-serif">Arial</option>
      <option value="'Courier New', monospace">Courier New</option>
    </select>

    <label class="label">Pages</label>
    <div class="page-tabs" id="pageTabs"></div>
    <div class="controls">
      <button id="addPage" class="btn">Add Page</button>
      <button id="removePage" class="btn">Remove Page</button>
    </div>

    <div class="controls">
      <button id="downloadPNG" class="btn">Download PNG</button>
      <button id="downloadPDF" class="btn">Download PDF</button>
      <button id="copyLink" class="btn">Copy Share Link</button>
    </div>

    <label class="label">Stickers / Floral</label>
    <div class="controls">
      <button class="sticker-btn" data-src="https://i.imgur.com/6VwP5bH.png">Floral TR</button>
      <button class="sticker-btn" data-src="https://i.imgur.com/7qGk6yR.png">Floral BL</button>
    </div>
  </div>

  <div class="panel right">
    <div class="preview-canvas" id="canvas"></div>
  </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const pageTabs = document.getElementById('pageTabs');
let pages = [[]]; 
let currentPage = 0;
let selectedEl = null;

// Draggable + resizable
function makeDraggable(el){
  let offsetX=0, offsetY=0, isDragging=false;
  let startWidth=0, startHeight=0, resizing=false;

  const handle = document.createElement('div');
  handle.className='resize-handle';
  el.appendChild(handle);

  handle.addEventListener('mousedown', e=>{
    resizing=true;
    startWidth=el.offsetWidth;
    startHeight=el.offsetHeight;
    offsetX=e.clientX; offsetY=e.clientY;
    e.stopPropagation();
  });

  document.addEventListener('mousemove', e=>{
    if(resizing){
      el.style.width=startWidth+(e.clientX-offsetX)+'px';
      el.style.height=startHeight+(e.clientY-offsetY)+'px';
      return;
    }
    if(!isDragging) return;
    el.style.left=(e.clientX - canvas.getBoundingClientRect().left - offsetX)+'px';
    el.style.top=(e.clientY - canvas.getBoundingClientRect().top - offsetY)+'px';
  });

  document.addEventListener('mouseup', e=>{ isDragging=false; resizing=false; });

  el.addEventListener('mousedown', e=>{
    if(e.target===handle) return;
    isDragging=true;
    selectedEl=el;
    el.classList.add('selected');
    offsetX=e.offsetX; offsetY=e.offsetY;
  });

  el.addEventListener('click', e=>{
    selectedEl=el;
    document.querySelectorAll('.element').forEach(x=>x.classList.remove('selected'));
    el.classList.add('selected');
    e.stopPropagation();
  });
}

// Pages
function renderTabs(){
  pageTabs.innerHTML='';
  pages.forEach((p, idx)=>{
    const tab=document.createElement('div');
    tab.className='page-tab'+(idx===currentPage?' active':'');
    tab.textContent='Page '+(idx+1);
    tab.addEventListener('click', ()=>{ currentPage=idx; renderCanvas(); });
    pageTabs.appendChild(tab);
  });
}
function renderCanvas(){
  canvas.innerHTML='';
  pages[currentPage].forEach(el=>{ canvas.appendChild(el); });
}

// Add Elements
document.getElementById('addText').addEventListener('click', ()=>{
  const div=document.createElement('div');
  div.className='element text-element';
  div.contentEditable=true;
  div.textContent='New Text';
  div.style.left='50px'; div.style.top='50px';
  div.style.fontSize='24px'; div.style.fontFamily="'Playfair Display', serif";
  makeDraggable(div);
  pages[currentPage].push(div);
  canvas.appendChild(div);
});
document.getElementById('addImage').addEventListener('click', ()=>{
  const input=document.createElement('input'); input.type='file'; input.accept='image/*'; input.click();
  input.onchange=e=>{
    const file=e.target.files[0];
    const reader=new FileReader();
    reader.onload=function(ev){
      const img=document.createElement('img');
      img.src=ev.target.result;
      img.className='element image-element';
      img.style.left='50px'; img.style.top='50px';
      img.style.width='150px'; img.style.height='150px';
      makeDraggable(img);
      pages[currentPage].push(img);
      canvas.appendChild(img);
    };
    reader.readAsDataURL(file);
  }
});

// Stickers
document.querySelectorAll('.sticker-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const img=document.createElement('img');
    img.src=btn.dataset.src;
    img.className='element image-element';
    img.style.left='50px'; img.style.top='50px';
    img.style.width='150px'; img.style.height='150px';
    makeDraggable(img);
    pages[currentPage].push(img);
    canvas.appendChild(img);
  });
});

// Text styling
document.getElementById('textColor').addEventListener('input', e=>{ if(selectedEl && selectedEl.classList.contains('text-element')) selectedEl.style.color=e.target.value; });
document.getElementById('fontSizeSelect').addEventListener('change', e=>{ if(selectedEl && selectedEl.classList.contains('text-element')) selectedEl.style.fontSize=e.target.value+'px'; });
document.getElementById('fontFamilySelect').addEventListener('change', e=>{ if(selectedEl && selectedEl.classList.contains('text-element')) selectedEl.style.fontFamily=e.target.value; });

// Element order & delete
document.getElementById('deleteElement').addEventListener('click', ()=>{ if(selectedEl){ selectedEl.remove(); pages[currentPage]=pages[currentPage].filter(e=>e!==selectedEl); } });
document.getElementById('bringFront').addEventListener('click', ()=>{ if(selectedEl) canvas.appendChild(selectedEl); });
document.getElementById('sendBack').addEventListener('click', ()=>{ if(selectedEl) canvas.insertBefore(selectedEl, canvas.firstChild); });

// Pages add/remove
document.getElementById('addPage').addEventListener('click', ()=>{ pages.push([]); currentPage=pages.length-1; renderTabs(); renderCanvas(); });
document.getElementById('removePage').addEventListener('click', ()=>{ if(pages.length>1){ pages.splice(currentPage,1); currentPage=Math.max(0,currentPage-1); renderTabs(); renderCanvas(); } });

// Deselect
canvas.addEventListener('click', ()=>{ selectedEl=null; document.querySelectorAll('.element').forEach(x=>x.classList.remove('selected')); });

// Download PNG
document.getElementById('downloadPNG').addEventListener('click', async ()=>{
  for(let i=0;i<pages.length;i++){
    const tempDiv=document.createElement('div'); tempDiv.style.position='absolute'; tempDiv.style.top='-10000px'; document.body.appendChild(tempDiv);
    pages[i].forEach(el=>{ tempDiv.appendChild(el.cloneNode(true)); });
    const c=await html2canvas(tempDiv,{scale:2});
    const a=document.createElement('a'); a.href=c.toDataURL('image/png'); a.download='poster_page'+(i+1)+'.png'; a.click();
    tempDiv.remove();
  }
});

// Download PDF
document.getElementById('downloadPDF').addEventListener('click', async ()=>{
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF('portrait','pt','a4'); 
  const margin=20;
  for(let i=0;i<pages.length;i++){
    const tempDiv=document.createElement('div'); tempDiv.style.position='absolute'; tempDiv.style.top='-10000px'; document.body.appendChild(tempDiv);
    pages[i].forEach(el=>{ tempDiv.appendChild(el.cloneNode(true)); });
    const c=await html2canvas(tempDiv,{scale:2});
    const imgData=c.toDataURL('image/png');
    const pdfWidth = pdf.internal.pageSize.getWidth() - margin*2;
    const pdfHeight = (c.height * pdfWidth)/c.width;
    pdf.addImage(imgData,'PNG',margin,margin,pdfWidth,pdfHeight);
    if(i<pages.length-1) pdf.addPage();
    tempDiv.remove();
  }
  pdf.save('poster.pdf');
});

// Share link
document.getElementById('copyLink').addEventListener('click', ()=>{
  const data = pages.map(p=>p.map(el=>({html:el.outerHTML,left:el.style.left,top:el.style.top})));
  const link = window.location.origin + window.location.pathname + '?data=' + encodeURIComponent(JSON.stringify(data));
  navigator.clipboard.writeText(link).then(()=>alert('Link copied!'));
});

renderTabs();
renderCanvas();
</script>
</body>
</html>
