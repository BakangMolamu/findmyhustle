<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Upload Your Hustle — FindMyHustle</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{--p1:#3b0a57;--p2:#0d1a5e;--card:bg(white);--accent1:#7b3fe4;--accent2:#4bc0ff}
    *{box-sizing:border-box}
    body{font-family:'Poppins',system-ui,Arial,sans-serif;margin:0;background:linear-gradient(135deg,var(--p1),var(--p2));color:#fff;padding:18px}
    .wrap{max-width:760px;margin:18px auto}
    .card{background:rgba(255,255,255,0.06);padding:18px;border-radius:12px;box-shadow:0 12px 30px rgba(0,0,0,.35)}
    h1{margin:0 0 8px;text-align:center}
    label{display:block;margin-top:12px;font-weight:600}
    input[type=text], input[type=email], input[type=url], select, textarea {
      width:100%;padding:10px;border-radius:8px;border:none;margin-top:6px;font-size:14px;
    }
    textarea{min-height:90px;resize:vertical}
    .media-preview{display:flex;gap:10px;margin-top:10px}
    .thumb{flex:1;min-height:120px;background:rgba(0,0,0,0.12);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#ddd;padding:6px}
    .thumb img{width:100%;height:100%;object-fit:cover;border-radius:6px}
    .note{font-size:13px;color:rgba(255,255,255,0.9);margin-top:8px}
    button.primary{width:100%;margin-top:16px;padding:12px;border-radius:10px;border:none;font-weight:800;background:linear-gradient(90deg,#7b3fe4,#4bc0ff);color:#fff;cursor:pointer}
    #overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:9999}
    #overlay.show{display:flex}
    .overlay-box{background:rgba(255,255,255,0.06);padding:14px 18px;border-radius:10px;color:#fff;font-weight:700}
    #success{position:fixed;left:50%;top:-120px;transform:translateX(-50%);background:#4cd964;color:#002;padding:12px 16px;border-radius:12px;font-weight:700;transition:all .5s;}
    #success.show{top:24px}
    @media(max-width:620px){.media-preview{flex-direction:column}}
  </style>
</head>
<body>
  <div id="success">✅ Submission saved — we'll contact you for verification.</div>
  <div id="overlay"><div class="overlay-box">Submitting — please wait…</div></div>

  <div class="wrap">
    <main class="card" role="main">
      <h1>Upload Your Hustle</h1>
      <p class="note">Paste two public image links (Imgur or imgbb recommended). Optional: add a video link (YouTube/Vimeo). New listings are set to Pending for verification.</p>

      <!-- Paste your deployed Apps Script Web App URL here -->
      <script>const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzUGuj9eN4_xEBNHIEr_sypGVXJ7QA6j04UjdZ9Wzc1zYiYezEaX2p-eF_d7haAXBff/exec";</script>

      <form id="uploadForm" novalidate>
        <label>Full name</label>
        <input id="name" name="Name" type="text" required placeholder="Your full name">

        <label>Email (we use this only to contact you)</label>
        <input id="email" name="Email" type="email" required placeholder="you@example.com">

        <div style="display:flex;gap:10px;margin-top:8px">
          <div style="flex:1">
            <label>Skill</label>
            <select id="skill" name="Skill" required>
              <option value="">Select skill</option>
              <option>Barber</option><option>Hairdresser</option><option>Nail Technician</option><option>Makeup Artist</option><option>Photographer</option><option>Videographer</option><option>Graphic Designer</option><option>Plumber</option><option>Electrician</option><option>Mechanic</option><option>Chef</option><option>Tailor</option><option>Carpenter</option><option>Gardener</option><option>DJ</option><option>Other</option>
            </select>
          </div>
          <div style="flex:1">
            <label>Province</label>
            <select id="province" name="Province" required>
              <option value="">Select province</option>
              <option>Eastern Cape</option><option>Free State</option><option>Gauteng</option><option>KwaZulu-Natal</option><option>Limpopo</option><option>Mpumalanga</option><option>Northern Cape</option><option>North West</option><option>Western Cape</option>
            </select>
          </div>
        </div>

        <label>City / Town</label>
        <input id="city" name="City" type="text" placeholder="e.g. Mahikeng" required>

        <label>Phone (WhatsApp)</label>
        <input id="phone" name="Phone" type="text" placeholder="+27..." required>

        <label>Short description</label>
        <textarea id="description" name="Description" placeholder="What you offer, rates, specialties..." required></textarea>

        <div class="media-preview" aria-hidden="true">
          <div class="thumb" id="thumb1">Picture 1 preview</div>
          <div class="thumb" id="thumb2">Picture 2 preview</div>
        </div>

        <label>Picture 1 URL (direct image link, required)</label>
        <input id="pic1" name="Picture1URL" type="url" placeholder="https://i.imgur.com/abc123.jpg" required>

        <label>Picture 2 URL (direct image link, required)</label>
        <input id="pic2" name="Picture2URL" type="url" placeholder="https://i.imgur.com/xyz456.png" required>

        <label>Video link (optional)</label>
        <input id="videourl" name="VideoURL" type="url" placeholder="https://www.youtube.com/watch?v=...">

        <p class="note">Tip: If you want multiple works in one image, create a collage and upload to Imgur/ImgBB to get a direct link ending with .jpg/.png/.webp.</p>

        <button id="submitBtn" class="primary" type="submit">Submit Hustle</button>
      </form>
    </main>
  </div>

  <script>
    const form = document.getElementById('uploadForm');
    const pic1Input = document.getElementById('pic1');
    const pic2Input = document.getElementById('pic2');
    const thumb1 = document.getElementById('thumb1');
    const thumb2 = document.getElementById('thumb2');
    const overlay = document.getElementById('overlay');
    const success = document.getElementById('success');
    const submitBtn = document.getElementById('submitBtn');

    function showPreview(url, container) {
      container.innerHTML = '';
      if (!url) { container.textContent = container.id === 'thumb1' ? 'Picture 1 preview' : 'Picture 2 preview'; return; }
      const img = document.createElement('img');
      img.alt = 'preview';
      img.onload = () => {};
      img.onerror = () => { container.textContent = 'Preview unavailable — check the URL'; };
      img.src = url;
      container.appendChild(img);
    }

    function looksLikeImageUrl(u) {
      if (!u) return false;
      try { new URL(u); } catch (e) { return false; }
      const lower = u.toLowerCase();
      return /\.(jpe?g|png|webp|gif|bmp|svg)(\?|$)/.test(lower) || lower.includes('imgur.com') || lower.includes('i.ibb.co') || lower.includes('images.unsplash.com');
    }

    function looksLikeVideoUrl(u) {
      if (!u) return false;
      try { new URL(u); } catch (e) { return false; }
      return u.includes('youtube.com') || u.includes('youtu.be') || u.includes('vimeo.com');
    }

    pic1Input.addEventListener('input', () => showPreview(pic1Input.value.trim(), thumb1));
    pic2Input.addEventListener('input', () => showPreview(pic2Input.value.trim(), thumb2));

    function setLoading(flag) {
      overlay.classList.toggle('show', flag);
      submitBtn.disabled = flag;
    }

    form.addEventListener('submit', async (ev) => {
      ev.preventDefault();

      if (typeof WEB_APP_URL === 'undefined' || !WEB_APP_URL || WEB_APP_URL.includes('PASTE_YOUR_WEB_APP_URL')) {
        alert('Please paste your Apps Script Web App URL into the upload.html (see top of file).');
        return;
      }

      const Name = (document.getElementById('name').value || '').trim();
      const Email = (document.getElementById('email').value || '').trim();
      const Skill = (document.getElementById('skill').value || '').trim();
      const Province = (document.getElementById('province').value || '').trim();
      const City = (document.getElementById('city').value || '').trim();
      const Description = (document.getElementById('description').value || '').trim();
      const Phone = (document.getElementById('phone').value || '').trim();
      const Picture1URL = (pic1Input.value || '').trim();
      const Picture2URL = (pic2Input.value || '').trim();
      const VideoURL = (document.getElementById('videourl').value || '').trim();

      if (!Name || !Email || !Skill || !Picture1URL || !Picture2URL) {
        alert('Please fill Name, Email, Skill and both image URLs.');
        return;
      }

      if (!looksLikeImageUrl(Picture1URL) || !looksLikeImageUrl(Picture2URL)) {
        if (!confirm('One or both image URLs do not look like direct image links. Continue anyway?')) return;
      }
      if (VideoURL && !looksLikeVideoUrl(VideoURL)) {
        if (!confirm('Video link does not look like YouTube/Vimeo. Continue anyway?')) return;
      }

      setLoading(true);

      const payload = { Name, Email, Skill, Province, City, Description, Phone, Picture1URL, Picture2URL, VideoURL };

      try {
        const resp = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const text = await resp.text();
        let result;
        try { result = JSON.parse(text); } catch (e) { result = { status: 'error', message: 'Invalid server response' }; }

        if (result.status === 'success') {
          success.classList.add('show');
          setTimeout(()=> success.classList.remove('show'), 3500);
          form.reset();
          thumb1.innerHTML = 'Picture 1 preview';
          thumb2.innerHTML = 'Picture 2 preview';

          // redirect to profile (shows Pending)
          if (result.id) {
            setTimeout(()=> window.location.href = `profile.html?id=${encodeURIComponent(result.id)}`, 1200);
          }
        } else {
          alert('Submission failed: ' + (result.message || 'Server error'));
        }
      } catch (err) {
        console.error('submit error', err);
        alert('Submission failed — check your internet connection and the web app URL.');
      } finally {
        setLoading(false);
      }
    });
  </script>
</body>
                                                                                                                                                      </html>
