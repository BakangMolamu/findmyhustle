<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Upload Your Hustle — FindMyHustle</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root{--p1:#3b0a57;--p2:#0d1a5e;--card:rgba(255,255,255,0.06);--accent1:#7b3fe4;--accent2:#4bc0ff}
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;font-family:'Poppins',system-ui,Arial,sans-serif;background:linear-gradient(135deg,var(--p1),var(--p2));color:#fff;display:flex;align-items:flex-start;justify-content:center;padding:28px;}
  .card{width:100%;max-width:760px;background:var(--card);padding:22px;border-radius:14px;box-shadow:0 12px 30px rgba(0,0,0,.35);backdrop-filter:blur(6px)}
  h1{margin:0 0 8px;font-size:22px;text-align:center}
  .lead{margin:0 0 18px;text-align:center;color:rgba(255,255,255,.9)}
  label{display:block;margin-top:12px;font-weight:600;font-size:13px;color:#f3f6ff}
  input[type=text],input[type=tel],select,textarea{width:100%;padding:10px;border-radius:10px;border:none;margin-top:6px;font-size:14px}
  textarea{min-height:90px;resize:vertical}
  .row{display:flex;gap:12px}
  .row .col{flex:1}
  .media-row{display:flex;gap:12px;margin-top:10px;flex-wrap:wrap}
  .thumb{flex:1;min-height:120px;background:rgba(0,0,0,0.18);border-radius:10px;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .note{font-size:13px;color:rgba(255,255,255,.85);margin-top:8px}
  button.primary{margin-top:18px;width:100%;padding:13px 14px;border-radius:10px;border:none;font-weight:800;font-size:16px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;cursor:pointer}
  button.primary:disabled{opacity:.6;cursor:default}
  #overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);align-items:center;justify-content:center;z-index:9998}
  #overlay.show{display:flex}
  .overlay-box{background:rgba(255,255,255,0.06);padding:14px 18px;border-radius:10px;color:white;font-weight:700}
  #successPopup{position:fixed;left:50%;top:-160px;transform:translateX(-50%);background:linear-gradient(135deg,#4cd964,#38f9d7);color:#002;padding:14px 18px;border-radius:12px;font-weight:700;box-shadow:0 8px 30px rgba(0,0,0,.35);z-index:9999;opacity:0;transition:all .6s cubic-bezier(.2,.9,.2,1)}
  #successPopup.show{top:20px;opacity:1}
  @media(max-width:520px){.row{flex-direction:column}.thumb{width:100%}}
</style>
</head>
<body>

<div id="successPopup">✅ Submission successful — we'll contact you for verification.</div>
<div id="overlay"><div class="overlay-box">Uploading — please wait…</div></div>

<main class="card" role="main" aria-labelledby="pageTitle">
  <h1 id="pageTitle">Upload Your Hustle</h1>
  <p class="lead">Two pictures only. Profiles show on Browse after verification.</p>

  <script>
    // ---------- PASTE YOUR WEB APP URL HERE ----------
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyhFS43VudgMWx8WDodYKfTRhlBPFIk7sBo6r62idH1mI5DGFTUl_q4NMGdYQSlImB6Kg/exec";
    // ------------------------------------------------
  </script>

  <form id="uploadForm" novalidate>
    <label for="name">Full Name</label>
    <input id="name" name="name" type="text" placeholder="Your full name" required>

    <div class="row">
      <div class="col">
        <label for="skill">Skill</label>
        <select id="skill" name="skill" required>
          <option value="">Select skill</option>
          <option>Barber</option>
          <option>Hairdresser / Braids</option>
          <option>Nail Technician</option>
          <option>Photographer</option>
          <option>Videographer</option>
          <option>Plumber</option>
          <option>Electrician</option>
          <option>Chef</option>
          <option>Tailor</option>
          <option>Other</option>
        </select>
      </div>

      <div class="col">
        <label for="province">Province</label>
        <select id="province" name="province" required>
          <option value="">Select province</option>
          <option>Eastern Cape</option>
          <option>Free State</option>
          <option>Gauteng</option>
          <option>KwaZulu-Natal</option>
          <option>Limpopo</option>
          <option>Mpumalanga</option>
          <option>Northern Cape</option>
          <option>North West</option>
          <option>Western Cape</option>
        </select>
      </div>
    </div>

    <label for="city">City / Town</label>
    <input id="city" name="city" type="text" placeholder="e.g. Mahikeng" required>

    <label for="description">Short description</label>
    <textarea id="description" name="description" placeholder="What you offer..." required></textarea>

    <label for="phone">WhatsApp / Phone</label>
    <input id="phone" name="phone" type="tel" placeholder="+27..." required>

    <div class="media-row" aria-hidden="true">
      <div class="thumb" id="thumbPic1">Picture 1 preview</div>
      <div class="thumb" id="thumbPic2">Picture 2 preview</div>
    </div>

    <label>Upload Picture 1 (JPG/PNG) — max 6MB</label>
    <input id="pic1" type="file" accept="image/*" required>

    <label>Upload Picture 2 (JPG/PNG) — max 6MB</label>
    <input id="pic2" type="file" accept="image/*" required>

    <p class="note">By submitting you confirm you own the media. New profiles are Pending Verification.</p>

    <button id="submitBtn" class="primary" type="submit">Submit Hustle</button>
  </form>
</main>

<script>
/* CONFIG */
const MAX_IMAGE = 6 * 1024 * 1024; // 6MB

/* ELEMENTS */
const form = document.getElementById('uploadForm');
const submitBtn = document.getElementById('submitBtn');
const overlay = document.getElementById('overlay');
const successPopup = document.getElementById('successPopup');

const nameInput = document.getElementById('name');
const skillInput = document.getElementById('skill');
const provinceInput = document.getElementById('province');
const cityInput = document.getElementById('city');
const descriptionInput = document.getElementById('description');
const phoneInput = document.getElementById('phone');

const pic1Input = document.getElementById('pic1');
const pic2Input = document.getElementById('pic2');
const thumbPic1 = document.getElementById('thumbPic1');
const thumbPic2 = document.getElementById('thumbPic2');

function showImagePreview(file, container) {
  container.innerHTML = '';
  const img = document.createElement('img');
  img.alt = 'preview';
  const reader = new FileReader();
  reader.onload = e => img.src = e.target.result;
  reader.readAsDataURL(file);
  container.appendChild(img);
}

pic1Input.addEventListener('change', () => {
  const f = pic1Input.files[0];
  if (f) { if (f.size > MAX_IMAGE) { alert('Picture 1 too large (max 6MB).'); pic1Input.value = ''; return; } showImagePreview(f, thumbPic1);} else thumbPic1.innerHTML='Picture 1 preview';
});
pic2Input.addEventListener('change', () => {
  const f = pic2Input.files[0];
  if (f) { if (f.size > MAX_IMAGE) { alert('Picture 2 too large (max 6MB).'); pic2Input.value = ''; return; } showImagePreview(f, thumbPic2);} else thumbPic2.innerHTML='Picture 2 preview';
});

function readFileAsDataURL(file) {
  return new Promise((res, rej) => {
    const fr = new FileReader();
    fr.onload = () => res(fr.result);
    fr.onerror = rej;
    fr.readAsDataURL(file);
  });
}

function splitDataUrl(dataUrl) {
  const m = dataUrl.match(/^data:(.+);base64,(.*)$/);
  return m ? { mime: m[1], base64: m[2] } : null;
}

function setUploading(flag) {
  overlay.classList.toggle('show', flag);
  submitBtn.disabled = flag;
}

form.addEventListener('submit', async (e) => {
  e.preventDefault();

  // validation
  const name = nameInput.value.trim();
  const skill = skillInput.value.trim();
  const province = provinceInput.value.trim();
  const city = cityInput.value.trim();
  const description = descriptionInput.value.trim();
  const phone = phoneInput.value.trim();
  if (!name || !skill || !province || !city || !description || !phone) { alert('Please fill all required fields.'); return; }

  const pic1 = pic1Input.files[0];
  const pic2 = pic2Input.files[0];
  if (!pic1 || !pic2) { alert('Please select two pictures.'); return; }
  if (pic1.size > MAX_IMAGE || pic2.size > MAX_IMAGE) { alert('One image is too large (max 6MB).'); return; }

  setUploading(true);

  try {
    const [pic1DataUrl, pic2DataUrl] = await Promise.all([readFileAsDataURL(pic1), readFileAsDataURL(pic2)]);
    const p1 = splitDataUrl(pic1DataUrl);
    const p2 = splitDataUrl(pic2DataUrl);
    if (!p1 || !p2) throw new Error('Failed to read images.');

    const payload = {
      Name: name,
      Skill: skill,
      Province: province,
      City: city,
      Description: description,
      Phone: phone,
      Picture1: { base64: p1.base64, mime: p1.mime, filename: pic1.name },
      Picture2: { base64: p2.base64, mime: p2.mime, filename: pic2.name }
    };

    const resp = await fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify(payload) });
    const text = await resp.text();
    let result;
    try { result = JSON.parse(text); } catch (err) { throw new Error('Server returned unexpected response'); }

    if (result && result.status === 'success') {
      successPopup.classList.add('show');
      setTimeout(() => successPopup.classList.remove('show'), 3000);
      form.reset();
      thumbPic1.innerHTML = 'Picture 1 preview';
      thumbPic2.innerHTML = 'Picture 2 preview';
      // redirect to profile page (shows pending)
      const id = encodeURIComponent(result.id);
      setTimeout(() => window.location.href = `profile.html?id=${id}`, 1200);
    } else {
      throw new Error(result && result.message ? result.message : 'Upload failed');
    }
  } catch (err) {
    console.error(err);
    let message = 'Upload failed. Try again.';
    if (err instanceof ProgressEvent) message = 'Upload failed: server not reachable or file too large.';
    else if (err.message) message = err.message;
    alert(message);
  } finally {
    setUploading(false);
  }
});
</script>
</body>
      </html>
