<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Upload Your Hustle — FindMyHustle</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  :root {
    --purple1: #3b0a57;
    --purple2: #0d1a5e;
    --card-bg: rgba(255,255,255,0.06);
    --accent1: #7b3fe4;
    --accent2: #4bc0ff;
  }

  html,body { height:100%; margin:0; font-family:'Poppins',system-ui,Arial,sans-serif; }
  body {
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:28px;
    min-height:100%;
    background: linear-gradient(135deg, var(--purple1), var(--purple2));
    color: #fff;
  }

  .card {
    width:100%;
    max-width:720px;
    background: var(--card-bg);
    border-radius:14px;
    padding:22px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.35);
    backdrop-filter: blur(6px);
  }

  h1 { margin:0 0 6px 0; font-size:22px; text-align:center; }
  p.lead { margin:0 0 18px 0; text-align:center; color: rgba(255,255,255,0.9); }

  label { display:block; font-weight:600; margin-top:12px; font-size:13px; color: #f3f6ff; }
  input[type="text"], input[type="tel"], input[type="email"], select, textarea {
    width:100%;
    padding:10px 12px;
    margin-top:6px;
    border-radius:10px;
    border: none;
    font-size:14px;
    outline: none;
  }

  textarea { min-height:90px; resize: vertical; }

  .media-row { display:flex; gap:12px; margin-top:10px; flex-wrap:wrap; }
  .thumb {
    width: calc(50% - 6px);
    min-height:120px;
    background: rgba(0,0,0,0.12);
    border-radius:10px;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .thumb img, .thumb video { width:100%; height:100%; object-fit:cover; display:block; }

  .note { font-size:13px; color: rgba(255,255,255,0.85); margin-top:8px; }

  .row { display:flex; gap:12px; margin-top:12px; }
  .row .col { flex:1; }

  button.primary {
    margin-top:18px;
    width:100%;
    padding:13px 14px;
    border-radius:10px;
    border: none;
    font-weight:800;
    font-size:16px;
    background: linear-gradient(90deg,var(--accent1),var(--accent2));
    color:white;
    cursor:pointer;
  }
  button.primary:disabled { opacity:0.6; cursor:not-allowed; transform:none; }

  /* success popup */
  #successPopup {
    position:fixed;
    left:50%;
    top:-160px;
    transform:translateX(-50%);
    background: linear-gradient(135deg,#4cd964,#38f9d7);
    color:#002;
    padding:14px 18px;
    border-radius:12px;
    font-weight:700;
    box-shadow:0 8px 30px rgba(0,0,0,0.35);
    z-index:9999;
    opacity:0;
    transition: all 0.6s cubic-bezier(.2,.9,.2,1);
  }
  #successPopup.show { top:20px; opacity:1; }

  /* overlay during upload */
  #overlay {
    display:none;
    position:fixed;
    inset:0;
    background: rgba(0,0,0,0.45);
    align-items:center;
    justify-content:center;
    z-index:9998;
  }
  #overlay.show { display:flex; }
  .overlay-box { background: rgba(255,255,255,0.06); padding:14px 18px; border-radius:10px; color:white; font-weight:700; }

  @media (max-width:520px) {
    .thumb { width:100%; }
  }
</style>
</head>
<body>

<div id="successPopup">✅ Submission successful — we'll contact you for verification.</div>
<div id="overlay"><div class="overlay-box">Uploading — please wait…</div></div>

<main class="card" role="main">
  <h1>Upload Your Hustle</h1>
  <p class="lead">Showcase your skill with 2 pictures and one short video. Profiles appear on Browse only after verification.</p>

  <!-- IMPORTANT: Paste your deployed Apps Script Web App URL below (must implement doPost & doGet) -->
  <script>
    // Paste your Web App URL between the quotes below:
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzPv4jMATIkjJma6j5Q2CnYL1UU9j6ANrBo7Sj3BFBcnkXkWae-fkGk6kesNJcjKsU2/exec";
    // Example: const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxxx/exec";
  </script>

  <form id="uploadForm" novalidate>

    <label for="name">Full Name</label>
    <input id="name" name="name" type="text" placeholder="Your full name" required>

    <div class="row">
      <div class="col">
        <label for="skill">Skill Category</label>
        <select id="skill" name="skill" required>
          <option value="">Select skill</option>
          <!-- long list of common hustles -->
          <option>Barber</option>
          <option>Hairdresser / Braids</option>
          <option>Nail Technician</option>
          <option>Makeup Artist</option>
          <option>Photographer</option>
          <option>Videographer</option>
          <option>Graphic Designer</option>
          <option>Social Media Manager</option>
          <option>DJ</option>
          <option>Musician / Singer</option>
          <option>MC / Host</option>
          <option>Dancer</option>
          <option>Chef / Caterer</option>
          <option>Baker</option>
          <option>Seamstress / Tailor</option>
          <option>Fashion Designer</option>
          <option>Carpenter</option>
          <option>Furniture Maker</option>
          <option>Painter</option>
          <option>Tiler</option>
          <option>Bricklayer</option>
          <option>Welder</option>
          <option>Mechanic</option>
          <option>Electrician</option>
          <option>Plumber</option>
          <option>Gardener / Landscaper</option>
          <option>House Cleaning</option>
          <option>Car Wash</option>
          <option>Courier / Delivery</option>
          <option>Tech Repair (Phones / Laptops)</option>
          <option>Tutor</option>
          <option>Personal Trainer</option>
          <option>Massage Therapist</option>
          <option>Tattoo Artist</option>
          <option>Shoe Repair</option>
          <option>Event Decorator</option>
          <option>Other</option>
        </select>
      </div>

      <div class="col">
        <label for="province">Province</label>
        <select id="province" name="province" required>
          <option value="">Select province</option>
          <option>Eastern Cape</option>
          <option>Free State</option>
          <option>Gauteng</option>
          <option>KwaZulu-Natal</option>
          <option>Limpopo</option>
          <option>Mpumalanga</option>
          <option>Northern Cape</option>
          <option>North West</option>
          <option>Western Cape</option>
        </select>
      </div>
    </div>

    <label for="city">City / Town</label>
    <input id="city" name="city" type="text" placeholder="e.g. Mahikeng" required>

    <label for="description">Short Description (what you offer)</label>
    <textarea id="description" name="description" placeholder="Write a short description for customers..." required></textarea>

    <label for="phone">WhatsApp / Phone (with country code)</label>
    <input id="phone" name="phone" type="tel" placeholder="+27..." required>

    <label>Upload Video (MP4/WebM) — max 50MB</label>
    <input id="video" type="file" accept="video/*" required>

    <div class="media-row">
      <div class="thumb" id="thumbPic1">Picture 1 preview</div>
      <div class="thumb" id="thumbPic2">Picture 2 preview</div>
    </div>

    <label>Upload Picture 1 (JPG/PNG) — max 6MB</label>
    <input id="pic1" type="file" accept="image/*" required>

    <label>Upload Picture 2 (JPG/PNG) — max 6MB</label>
    <input id="pic2" type="file" accept="image/*" required>

    <p class="note">By submitting you confirm you own the media and agree to be contacted for verification. New profiles are hidden from Browse until verified.</p>

    <button id="submitBtn" class="primary" type="submit">Submit Hustle</button>
  </form>
</main>

<script>
/* ---------- CONFIG ---------- */
/* IMPORTANT: Put your deployed Apps Script Web App URL in the WEB_APP_URL constant above.
   The web app must implement doPost(e) to accept JSON (payload below) and respond with:
   { status: "success", id: "H..." } on success.
*/

const MAX_IMAGE = 6 * 1024 * 1024;   // 6MB
const MAX_VIDEO = 50 * 1024 * 1024;  // 50MB

const form = document.getElementById('uploadForm');
const pic1Input = document.getElementById('pic1');
const pic2Input = document.getElementById('pic2');
const videoInput = document.getElementById('video');
const thumbPic1 = document.getElementById('thumbPic1');
const thumbPic2 = document.getElementById('thumbPic2');
const successPopup = document.getElementById('successPopup');
const overlay = document.getElementById('overlay');
const submitBtn = document.getElementById('submitBtn');

// preview helpers
function showImagePreview(file, container) {
  container.innerHTML = '';
  if (!file) return;
  const img = document.createElement('img');
  img.alt = 'preview';
  const reader = new FileReader();
  reader.onload = (e) => { img.src = e.target.result; };
  reader.readAsDataURL(file);
  container.appendChild(img);
}

function showVideoPreview(file) {
  // optional: show small video in place of one thumb (not required)
}

// convert file -> dataURL (base64)
function readAsDataURL(file) {
  return new Promise((resolve, reject) => {
    const fr = new FileReader();
    fr.onload = () => resolve(fr.result);
    fr.onerror = reject;
    fr.readAsDataURL(file);
  });
}

// split data URL into { mime, base64 }
function splitDataUrl(dataUrl) {
  const m = dataUrl.match(/^data:(.+);base64,(.*)$/);
  if (!m) return null;
  return { mime: m[1], base64: m[2] };
}

// show/hide overlay
function setUploading(isUploading) {
  if (isUploading) overlay.classList.add('show');
  else overlay.classList.remove('show');
}

// file change previews
pic1Input.addEventListener('change', () => {
  const f = pic1Input.files[0];
  if (f && f.size <= MAX_IMAGE) showImagePreview(f, thumbPic1);
  else if (f) thumbPic1.textContent = 'Image too large';
});
pic2Input.addEventListener('change', () => {
  const f = pic2Input.files[0];
  if (f && f.size <= MAX_IMAGE) showImagePreview(f, thumbPic2);
  else if (f) thumbPic2.textContent = 'Image too large';
});

// main submit
form.addEventListener('submit', async function(e) {
  e.preventDefault();

  // check WEB_APP_URL exists
  if (typeof WEB_APP_URL === 'undefined' || !WEB_APP_URL || WEB_APP_URL.includes('https://script.google.com/macros/s/AKfycbzPv4jMATIkjJma6j5Q2CnYL1UU9j6ANrBo7Sj3BFBcnkXkWae-fkGk6kesNJcjKsU2/exec')) {
    alert('Please paste your Apps Script Web App URL into the upload.html (see top of file).');
    return;
  }

  // basic form checks
  const name = (document.getElementById('name').value || '').trim();
  const skill = (document.getElementById('skill').value || '').trim();
  const province = (document.getElementById('province').value || '').trim();
  const city = (document.getElementById('city').value || '').trim();
  const description = (document.getElementById('description').value || '').trim();
  const phone = (document.getElementById('phone').value || '').trim();

  if (!name || !skill || !province || !city || !description || !phone) {
    alert('Please fill all required fields.');
    return;
  }

  const pic1 = pic1Input.files[0];
  const pic2 = pic2Input.files[0];
  const video = videoInput.files[0];

  if (!pic1 || !pic2 || !video) {
    alert('Please select two pictures and one video.');
    return;
  }
  if (pic1.size > MAX_IMAGE || pic2.size > MAX_IMAGE) {
    alert('One of the images is too large (max 6MB).');
    return;
  }
  if (video.size > MAX_VIDEO) {
    alert('Video is too large (max 50MB).');
    return;
  }

  // disable submit
  submitBtn.disabled = true;
  submitBtn.textContent = 'Uploading… please wait';
  setUploading(true);

  try {
    // convert to data URLs
    const [pic1DataUrl, pic2DataUrl, videoDataUrl] = await Promise.all([
      readAsDataURL(pic1),
      readAsDataURL(pic2),
      readAsDataURL(video)
    ]);

    const pic1Parts = splitDataUrl(pic1DataUrl);
    const pic2Parts = splitDataUrl(pic2DataUrl);
    const videoParts = splitDataUrl(videoDataUrl);

    if (!pic1Parts || !pic2Parts || !videoParts) throw new Error('Failed to read files.');

    // prepare payload matching expected Apps Script shape
    const payload = {
      Name: name,
      Skill: skill,
      Province: province,
      City: city,
      Description: description,
      Phone: phone,
      Picture1: { base64: pic1Parts.base64, mime: pic1Parts.mime, filename: pic1.name },
      Picture2: { base64: pic2Parts.base64, mime: pic2Parts.mime, filename: pic2.name },
      Video: { base64: videoParts.base64, mime: videoParts.mime, filename: video.name }
    };

    // POST JSON
    const resp = await fetch(WEB_APP_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    // fetch can fail for deployment reasons → throw explicit error
    if (!resp.ok) {
      const text = await resp.text().catch(()=>'');
      throw new Error('Server returned HTTP ' + resp.status + ' — ' + text);
    }

    const text = await resp.text();
    let result;
    try { result = JSON.parse(text); } catch (err) { throw new Error('Server returned unexpected response'); }

    if (result.status && result.status === 'success') {
      // show success popup
      successPopup.classList.add('show');
      setTimeout(()=> successPopup.classList.remove('show'), 3500);

      // reset UI
      form.reset();
      thumbPic1.innerHTML = 'Picture 1 preview';
      thumbPic2.innerHTML = 'Picture 2 preview';
      submitBtn.disabled = false;
      submitBtn.textContent = 'Submit Hustle';
      setUploading(false);

      // redirect to profile page (uploader can view pending profile)
      const id = encodeURIComponent(result.id);
      setTimeout(()=> window.location.href = `profile.html?id=${id}`, 1200);

    } else {
      throw new Error(result.message || 'Upload failed');
    }
  } catch (err) {
    console.error('Upload error', err);
    alert('Upload failed: ' + (err.message || err));
    submitBtn.disabled = false;
    submitBtn.textContent = 'Submit Hustle';
    setUploading(false);
  }
});
</script>
</body>
            </html>
