<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Upload Your Hustle — FindMyHustle</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root{--p1:#3b0a57;--p2:#0d1a5e;--card:rgba(255,255,255,0.06);--accent1:#7b3fe4;--accent2:#4bc0ff}
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;font-family:'Poppins',system-ui,Arial,sans-serif;background:linear-gradient(135deg,var(--p1),var(--p2));color:#fff;display:flex;align-items:flex-start;justify-content:center;padding:28px;}
  .card{width:100%;max-width:820px;background:var(--card);padding:22px;border-radius:14px;box-shadow:0 12px 30px rgba(0,0,0,.35);backdrop-filter:blur(6px)}
  h1{margin:0 0 8px;font-size:22px;text-align:center}
  .lead{margin:0 0 18px;text-align:center;color:rgba(255,255,255,.9)}
  label{display:block;margin-top:12px;font-weight:600;font-size:13px;color:#f3f6ff}
  input[type=text],input[type=url],input[type=tel],select,textarea{width:100%;padding:10px;border-radius:10px;border:none;margin-top:6px;font-size:14px}
  textarea{min-height:90px;resize:vertical}
  .row{display:flex;gap:12px}
  .row .col{flex:1}
  .media-row{display:flex;gap:12px;margin-top:10px;flex-wrap:wrap}
  .thumb{flex:1;min-height:140px;background:rgba(0,0,0,0.18);border-radius:10px;display:flex;align-items:center;justify-content:center;overflow:hidden;color:#ddd;padding:6px}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .note{font-size:13px;color:rgba(255,255,255,.85);margin-top:8px}
  .hint{font-size:13px;color:rgba(255,255,255,.75);margin-top:6px}
  button.primary{margin-top:18px;width:100%;padding:13px 14px;border-radius:10px;border:none;font-weight:800;font-size:16px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;cursor:pointer}
  button.primary:disabled{opacity:.6;cursor:default}
  #overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);align-items:center;justify-content:center;z-index:9998}
  #overlay.show{display:flex}
  .overlay-box{background:rgba(255,255,255,0.06);padding:14px 18px;border-radius:10px;color:white;font-weight:700}
  #successPopup{position:fixed;left:50%;top:-160px;transform:translateX(-50%);background:linear-gradient(135deg,#4cd964,#38f9d7);color:#002;padding:14px 18px;border-radius:12px;font-weight:700;box-shadow:0 8px 30px rgba(0,0,0,.35);z-index:9999;opacity:0;transition:all .6s cubic-bezier(.2,.9,.2,1)}
  #successPopup.show{top:20px;opacity:1}
  .tutorial { margin-top:14px; background: rgba(0,0,0,0.08); padding:10px; border-radius:10px; color: #eef; font-size:13px; }
  .tutorial a { color: #fff; text-decoration:underline; }
  .video-btn { display:inline-block; margin-top:10px; padding:8px 12px; background: linear-gradient(90deg,#ff5f6d,#ffc371); color:#fff; border-radius:10px; text-decoration:none; font-weight:700; }
  @media(max-width:560px){ .row{flex-direction:column} .thumb{min-height:120px} }
</style>
</head>
<body>

<div id="successPopup">✅ Listing saved — we will contact you for verification.</div>
<div id="overlay"><div class="overlay-box">Submitting — please wait…</div></div>

<main class="card" role="main" aria-labelledby="title">
  <h1 id="title">Upload Your Hustle</h1>
  <p class="lead">Paste two public image links (e.g. Imgur) so your work can appear in Browse. Optional: add a video link (YouTube or other) — a <strong>Video</strong> button will show on your profile.</p>

  <form id="uploadForm" novalidate>

    <label for="name">Full Name</label>
    <input id="name" name="name" type="text" placeholder="Your full name" required>

    <div class="row">
      <div class="col">
        <label for="skill">Skill</label>
        <select id="skill" name="skill" required>
          <option value="">Select skill</option>
          <option>Barber</option><option>Hairdresser</option><option>Nail Technician</option><option>Photographer</option><option>Videographer</option><option>Plumber</option><option>Electrician</option><option>Chef</option><option>Tailor</option><option>Other</option>
        </select>
      </div>
      <div class="col">
        <label for="province">Province</label>
        <select id="province" name="province" required>
          <option value="">Select province</option>
          <option>Eastern Cape</option><option>Free State</option><option>Gauteng</option><option>KwaZulu-Natal</option><option>Limpopo</option><option>Mpumalanga</option><option>Northern Cape</option><option>North West</option><option>Western Cape</option>
        </select>
      </div>
    </div>

    <label for="city">City / Town</label>
    <input id="city" name="city" type="text" placeholder="e.g. Mahikeng" required>

    <label for="description">Short description</label>
    <textarea id="description" name="description" placeholder="What you offer..." required></textarea>

    <label for="phone">WhatsApp / Phone (with country code)</label>
    <input id="phone" name="phone" type="tel" placeholder="+27..." required>

    <div class="tutorial">
      <strong>Quick guide — how to get an image link (preferred: Imgur)</strong>
      <ol style="margin:8px 0 0 18px; padding:0; color:#eef;">
        <li>Go to <a href="https://imgbb.com/" target="_blank" rel="noopener">imgbb.com</a> (or <a href="https://imgur.com/upload" target="_blank" rel="noopener">imgur.com</a>).</li>
        <li>Upload your photo, then copy the <em>direct image URL</em> (link ending in .jpg/.png).</li>
        <li>Paste that URL into the Image URL fields below.</li>
      </ol>
      <p class="hint">Want a video guide? Watch a short tutorial: <a href="https://www.youtube.com/results?search_query=how+to+upload+image+imgur+and+get+link" target="_blank" rel="noopener">YouTube: Upload to Imgur</a></p>
      <p class="hint">Tip: Make a collage image that shows 3–6 of your works if you want to highlight more in a single image.</p>
    </div>

    <div class="media-row" aria-hidden="true">
      <div class="thumb" id="thumbPic1">Picture 1 (preview)</div>
      <div class="thumb" id="thumbPic2">Picture 2 (preview)</div>
    </div>

    <label for="pic1url">Picture 1 — paste direct image URL (required)</label>
    <input id="pic1url" name="pic1url" type="url" placeholder="https://i.imgur.com/abc123.jpg" required>

    <label for="pic2url">Picture 2 — paste direct image URL (required)</label>
    <input id="pic2url" name="pic2url" type="url" placeholder="https://i.imgur.com/xyz456.png" required>

    <label for="videourl">Video link (optional) — paste YouTube / Vimeo / public link</label>
    <input id="videourl" name="videourl" type="url" placeholder="https://www.youtube.com/watch?v=..." />
    <div class="hint">If provided, a beautiful "Watch Video" button will appear on your Browse/Profile</div>

    <p class="note">By submitting you confirm you own the media or have permission. Profiles are hidden until verified.</p>

    <button id="submitBtn" class="primary" type="submit">Submit Hustle</button>
  </form>
</main>

<script>
/* ---------- CONFIG: PASTE YOUR WEB APP URL HERE ---------- */
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwq1I677UX0aBeZZ9J26Zeh_SMealdvjPqOkev5bmkTBLhfiaTuH3zj5CvVUXltIRZO/exec";
/* -------------------------------------------------------- */

const MAX_URL_LENGTH = 2000; // just a sanity limit

const form = document.getElementById('uploadForm');
const pic1Input = document.getElementById('pic1url');
const pic2Input = document.getElementById('pic2url');
const thumbPic1 = document.getElementById('thumbPic1');
const thumbPic2 = document.getElementById('thumbPic2');
const videourlInput = document.getElementById('videourl');
const overlay = document.getElementById('overlay');
const successPopup = document.getElementById('successPopup');
const submitBtn = document.getElementById('submitBtn');

// simple helper: check URL looks like image
function looksLikeImageUrl(u) {
  if (!u) return false;
  try { const url = new URL(u); } catch(e){ return false; }
  const lower = u.toLowerCase();
  return /\.(jpe?g|png|webp|gif|bmp|svg)(\?|$)/.test(lower) || lower.includes('imgur.com') || lower.includes('i.ibb.co') || lower.includes('images.unsplash.com');
}

// preview by creating an <img> with the URL; hide if fails
function showPreview(url, container) {
  container.innerHTML = '';
  if (!url) { container.textContent = container.id === 'thumbPic1' ? 'Picture 1 (preview)' : 'Picture 2 (preview)'; return;}
  const img = document.createElement('img');
  img.alt = 'preview';
  img.onload = () => { /* ok */ };
  img.onerror = () => { container.textContent = 'Preview unavailable — check the URL'; };
  img.src = url;
  container.appendChild(img);
}

pic1Input.addEventListener('input', () => {
  const v = pic1Input.value.trim();
  showPreview(v, thumbPic1);
});
pic2Input.addEventListener('input', () => {
  const v = pic2Input.value.trim();
  showPreview(v, thumbPic2);
});

// simple video link validation (optional)
function looksLikeVideoUrl(u) {
  if (!u) return false;
  try { new URL(u); } catch(e) { return false; }
  return u.includes('youtube.com') || u.includes('vimeo.com') || u.includes('youtu.be');
}

function setLoading(flag) {
  overlay.classList.toggle('show', flag);
  submitBtn.disabled = flag;
}

form.addEventListener('submit', async (e) => {
  e.preventDefault();

  if (!WEB_APP_URL || WEB_APP_URL.includes('PASTE_YOUR')) {
    alert('Please paste your Apps Script Web App URL into the top of this file before submitting.');
    return;
  }

  // gather fields
  const name = (document.getElementById('name').value || '').trim();
  const skill = (document.getElementById('skill').value || '').trim();
  const province = (document.getElementById('province').value || '').trim();
  const city = (document.getElementById('city').value || '').trim();
  const description = (document.getElementById('description').value || '').trim();
  const phone = (document.getElementById('phone').value || '').trim();
  const pic1 = pic1Input.value.trim();
  const pic2 = pic2Input.value.trim();
  const videourl = videourlInput.value.trim();

  // basic validation
  if (!name || !skill || !province || !city || !description || !phone) { alert('Please fill all required fields.'); return; }
  if (!pic1 || !pic2) { alert('Please paste two image URLs.'); return; }
  if (!looksLikeImageUrl(pic1) || !looksLikeImageUrl(pic2)) {
    if (!confirm('One or both image links do not look like a direct image URL. Continue anyway?')) return;
  }
  if (videourl && !looksLikeVideoUrl(videourl)) {
    if (!confirm('Video link does not look like YouTube/Vimeo. Continue anyway?')) { return; }
  }

  setLoading(true);

  // prepare payload (matches sheet fields)
  const payload = {
    Name: name,
    Skill: skill,
    Province: province,
    City: city,
    Description: description,
    Phone: phone,
    Picture1URL: pic1,
    Picture2URL: pic2,
    VideoURL: videourl || ""
  };

  try {
    const resp = await fetch(WEB_APP_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const text = await resp.text();
    let result;
    try { result = JSON.parse(text); } catch (err) { result = { status: 'error', message: 'Unexpected server response' }; }

    if (result.status === 'success') {
      successPopup.classList.add('show');
      setTimeout(()=> successPopup.classList.remove('show'), 3000);
      form.reset();
      thumbPic1.innerHTML = 'Picture 1 (preview)';
      thumbPic2.innerHTML = 'Picture 2 (preview)';
      // redirect to profile after short delay (profile might show Pending)
      setTimeout(()=> {
        if (result.id) window.location.href = `profile.html?id=${encodeURIComponent(result.id)}`;
      }, 1200);
    } else {
      alert('Submission failed: ' + (result.message || 'Server error'));
    }
  } catch (err) {
    console.error(err);
    alert('Submission failed — check your internet connection or app URL.');
  } finally {
    setLoading(false);
  }
});
</script>
</body>
  </html>
