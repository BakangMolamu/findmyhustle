<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Upload Your Hustle — FindMyHustle</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  :root {
    --purple1: #3b0a57;
    --purple2: #0d1a5e;
    --card-bg: rgba(255,255,255,0.06);
    --accent1: #7b3fe4;
    --accent2: #4bc0ff;
  }

  html,body { height:100%; margin:0; font-family:'Poppins',system-ui,Arial,sans-serif; }
  body {
    display:flex;
    justify-content:center;
    padding:28px;
    background: linear-gradient(135deg, var(--purple1), var(--purple2));
    color:#fff;
  }

  .card {
    width:100%;
    max-width:720px;
    background:var(--card-bg);
    border-radius:14px;
    padding:22px;
    box-shadow:0 12px 30px rgba(0,0,0,0.35);
    backdrop-filter:blur(6px);
  }

  h1 { text-align:center; margin-bottom:6px; }
  p.lead { text-align:center; margin-bottom:18px; }

  label { display:block; margin-top:12px; font-weight:600; font-size:13px; }
  input, select, textarea {
    width:100%;
    padding:10px;
    margin-top:6px;
    border-radius:10px;
    border:none;
    font-size:14px;
  }

  textarea { min-height:90px; }

  .row { display:flex; gap:12px; }
  .row .col { flex:1; }

  .media-row { display:flex; gap:12px; margin-top:10px; }
  .thumb {
    flex:1;
    min-height:120px;
    background:rgba(0,0,0,0.2);
    border-radius:10px;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .thumb img { width:100%; height:100%; object-fit:cover; }

  button {
    width:100%;
    margin-top:20px;
    padding:14px;
    border:none;
    border-radius:10px;
    font-size:16px;
    font-weight:800;
    background:linear-gradient(90deg,var(--accent1),var(--accent2));
    color:white;
    cursor:pointer;
  }

  #overlay {
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.5);
    align-items:center;
    justify-content:center;
    font-weight:700;
  }

  #overlay.show { display:flex; }

  #successPopup {
    position:fixed;
    top:-100px;
    left:50%;
    transform:translateX(-50%);
    background:#4cd964;
    color:#002;
    padding:14px 18px;
    border-radius:12px;
    font-weight:700;
    transition:0.5s;
  }

  #successPopup.show { top:20px; }
</style>
</head>
<body>

<div id="overlay">Uploading… please wait</div>
<div id="successPopup">✅ Submission successful — we’ll contact you for verification.</div>

<main class="card">
<h1>Upload Your Hustle</h1>
<p class="lead">Profiles appear on Browse only after verification.</p>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw-S4oJ7HYyB70My97GeHDu6ls_XSRTjYxWQD51zMoPRzCHo8SYFfWRwy83-j4dyWMG/exec";
</script>

<form id="uploadForm">

<label>Full Name</label>
<input id="name" required>

<div class="row">
  <div class="col">
    <label>Skill</label>
    <select id="skill" required>
      <option value="">Select skill</option>
      <option>Barber</option>
      <option>Hairdresser</option>
      <option>Photographer</option>
      <option>Videographer</option>
      <option>Electrician</option>
      <option>Plumber</option>
      <option>Graphic Designer</option>
      <option>Other</option>
    </select>
  </div>

  <div class="col">
    <label>Province</label>
    <select id="province" required>
      <option value="">Select province</option>
      <option>Eastern Cape</option>
      <option>Free State</option>
      <option>Gauteng</option>
      <option>KwaZulu-Natal</option>
      <option>Limpopo</option>
      <option>Mpumalanga</option>
      <option>North West</option>
      <option>Western Cape</option>
    </select>
  </div>
</div>

<label>City</label>
<input id="city" required>

<label>Description</label>
<textarea id="description" required></textarea>

<label>Phone</label>
<input id="phone" required>

<label>Video</label>
<input id="video" type="file" accept="video/*" required>

<div class="media-row">
  <div class="thumb" id="thumb1">Picture 1</div>
  <div class="thumb" id="thumb2">Picture 2</div>
</div>

<label>Picture 1</label>
<input id="pic1" type="file" accept="image/*" required>

<label>Picture 2</label>
<input id="pic2" type="file" accept="image/*" required>

<button type="submit">Submit Hustle</button>
</form>
</main>

<script>
const form = document.getElementById("uploadForm");
const overlay = document.getElementById("overlay");
const successPopup = document.getElementById("successPopup");

const nameInput = document.getElementById("name");
const skillInput = document.getElementById("skill");
const provinceInput = document.getElementById("province");
const cityInput = document.getElementById("city");
const descriptionInput = document.getElementById("description");
const phoneInput = document.getElementById("phone");

const pic1Input = document.getElementById("pic1");
const pic2Input = document.getElementById("pic2");
const videoInput = document.getElementById("video");

function readFile(file) {
  return new Promise(res => {
    const r = new FileReader();
    r.onload = () => res(r.result);
    r.readAsDataURL(file);
  });
}

function split(d) {
  const m = d.match(/^data:(.+);base64,(.*)$/);
  return { mime:m[1], base64:m[2] };
}

form.addEventListener("submit", async e => {
  e.preventDefault();
  overlay.classList.add("show");

  const payload = {
    Name: nameInput.value,
    Skill: skillInput.value,
    Province: provinceInput.value,
    City: cityInput.value,
    Description: descriptionInput.value,
    Phone: phoneInput.value,
    Picture1: { filename: pic1Input.files[0].name, ...split(await readFile(pic1Input.files[0])) },
    Picture2: { filename: pic2Input.files[0].name, ...split(await readFile(pic2Input.files[0])) },
    Video: { filename: videoInput.files[0].name, ...split(await readFile(videoInput.files[0])) }
  };

  

  let j;
try {
  const r = await fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  });

  const t = await r.text();
  j = JSON.parse(t);

} catch (err) {
  overlay.classList.remove("show");
  alert("Submission failed. Please try again.");
  console.error(err);
  return;
}

  overlay.classList.remove("show");

  if(j.status==="success"){
    successPopup.classList.add("show");
    setTimeout(()=>location.href=`profile.html?id=${j.id}`,1200);
  } else {
    alert("Upload failed");
  }
});
</script>
</body>
    </html>
