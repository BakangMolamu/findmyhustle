<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Feedback Platform</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #8e2de2, #6dd5fa);
  color: #333;
}
header {
  text-align: center;
  padding: 30px 15px;
  color: #fff;
}
header h1 { margin: 0; font-size: 28px; }
header p { margin: 5px 0 0; font-size: 16px; }
header button {
  margin-top: 10px;
  background:#fff; color:#6a1b9a;
  border:none; padding:10px 20px;
  border-radius:50px; cursor:pointer;
  font-weight:bold;
}
header button:hover { background:#eee; }

.container {
  max-width: 950px;
  margin: 20px auto;
  padding: 20px;
  background: rgba(255,255,255,0.95);
  border-radius: 15px;
}

h2 { color: #6a1b9a; margin-bottom: 15px; }
select, input, textarea {
  width: 100%; padding: 12px; margin: 10px 0;
  border-radius: 8px; border: 1px solid #ccc;
  font-size: 14px;
}
button.submit-btn {
  background: #6a1b9a; color:#fff; border:none;
  padding:12px 25px; border-radius:50px;
  cursor:pointer; font-size:16px;
  box-shadow:0 4px 15px rgba(0,0,0,0.2);
  margin-top:10px; transition:0.3s;
}
button.submit-btn:hover { background:#7b3fa0; transform:translateY(-2px); }

.comment {
  background: #fff; padding: 15px; border-radius:12px;
  margin-bottom:12px; box-shadow:0 2px 10px rgba(0,0,0,0.1);
}
.comment-header { font-weight:bold; font-size:14px; }
.comment-email { font-size:12px; color:#555; margin-bottom:5px;}
.reactions button {
  margin-right:8px; font-size:14px; padding:4px 12px;
  border-radius:20px; border:1px solid #ccc; cursor:pointer;
  transition:0.2s;
}
.reactions button:hover { background:#6a1b9a; color:#fff; border:none; }

#analytics {
  margin-top: 30px; padding: 15px;
  background: rgba(255,255,255,0.95); border-radius:12px;
  box-shadow:0 2px 10px rgba(0,0,0,0.1);
}

.error { color:red; font-size:14px; }

/* Modal */
.modal { display:none; position:fixed; z-index:100; padding-top:60px;
  left:0; top:0; width:100%; height:100%; overflow:auto;
  background-color:rgba(0,0,0,0.6);
}
.modal-content { background-color:#fff; margin:auto; padding:20px;
  border-radius:12px; max-width:700px; }
.close { color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer; }
.close:hover { color:#000; }

@media (max-width:600px){
  header h1{font-size:24px;}
  button.submit-btn{font-size:14px;padding:10px 18px;}
  .container{padding:15px;}
}
</style>
</head>
<body>

<header>
  <h1>Student Feedback Platform</h1>
  <p>Safe & Kind Platform for Students</p>
  <button onclick="openModal()">Terms & Conditions</button>
</header>

<div class="container">
  <h2>Step 1: Select University</h2>
  <select id="university" onchange="enableCategory()">
    <option value="">Select University</option>
  </select>

  <h2>Step 2: Select Category</h2>
  <select id="category" disabled onchange="displayComments()">
    <option value="">Select Category</option>
    <option value="Academics">Academics</option>
    <option value="Courses">Courses</option>
    <option value="Professors">Professors / Lecturers</option>
    <option value="Sports">Sports & Extracurriculars</option>
    <option value="Environment">Campus Life & Environment</option>
    <option value="Security">Safety & Security</option>
    <option value="Facilities">Facilities & Infrastructure</option>
    <option value="Administration">Administration</option>
    <option value="Support">Support Services</option>
    <option value="Other">Other / Suggestions</option>
  </select>

  <h2>Step 3: View Comments</h2>
  <div id="comments"></div>

  <h2>Step 4: Submit Feedback</h2>
  <div class="error" id="errorMsg"></div>
  <input type="text" id="course" placeholder="Course Name (optional)">
  <input type="text" id="lecturer" placeholder="Lecturer Name (optional)">
  <input type="number" id="rating" placeholder="Rating 1-5" min="1" max="5">
  <textarea id="comment" placeholder="Your comment"></textarea>
  <input type="email" id="email" placeholder="Your email">
  <label><input type="checkbox" id="anonymous"> Post anonymously</label>
  <button class="submit-btn" onclick="submitComment()">Submit Feedback</button>

  <h2>Step 5: Analytics</h2>
  <canvas id="analyticsChart" height="150"></canvas>
</div>

<!-- Terms Modal -->
<div id="termsModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>Terms & Conditions</h2>
    <p>All students must provide a valid email. Anonymity is optional, but misbehavior leads to permanent ban of the email. The platform is safe and kind. Use responsibly.</p>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Universities array
const universities = [
  "University of Cape Town","University of the Witwatersrand","Stellenbosch University",
  "University of Pretoria","University of KwaZulu-Natal","University of the Western Cape",
  "Rhodes University","University of the Free State","University of Fort Hare",
  "Nelson Mandela University","University of Limpopo","University of Venda",
  "Walter Sisulu University","University of Zululand","Cape Peninsula University of Technology",
  "Tshwane University of Technology","Durban University of Technology","Central University of Technology",
  "Vaal University of Technology","Sol Plaatje University","Mangosuthu University of Technology",
  "University of Mpumalanga","University of Johannesburg","University of South Africa",
  "North-West University","Monash South Africa"
];

// Fill university dropdown
const uniSelect = document.getElementById("university");
universities.forEach(u=>{
  const opt=document.createElement("option"); opt.value=u; opt.text=u;
  uniSelect.appendChild(opt);
});

// Data storage
let comments = [];
let bannedEmails = [];
let reacted = {}; // {email_commentIndex: true}

// Modal functions
function openModal(){document.getElementById("termsModal").style.display="block";}
function closeModal(){document.getElementById("termsModal").style.display="none";}

// Enable category after university selected
function enableCategory(){
  const cat=document.getElementById("category");
  if(uniSelect.value) cat.disabled=false;
  else cat.disabled=true;
  displayComments();
}

// Submit comment
function submitComment(){
  const uni=uniSelect.value;
  const cat=document.getElementById("category").value;
  const course=document.getElementById("course").value;
  const lecturer=document.getElementById("lecturer").value;
  const rating=document.getElementById("rating").value;
  const comment=document.getElementById("comment").value;
  const email=document.getElementById("email").value;
  const anon=document.getElementById("anonymous").checked;
  const errorDiv=document.getElementById("errorMsg");

  if(!uni||!cat||!comment||!email){errorDiv.textContent="Please fill all required fields."; return;}
  if(bannedEmails.includes(email)){errorDiv.textContent="This email is banned."; return;}
  errorDiv.textContent="";

  comments.push({uni,cat,course,lecturer,rating:Number(rating)||0,comment,email:anon?"Anonymous":email,likes:0,dislikes:0});
  document.getElementById("course").value="";
  document.getElementById("lecturer").value="";
  document.getElementById("rating").value="";
  document.getElementById("comment").value="";
  document.getElementById("email").value="";
  displayComments();
}

// Display comments for selected uni & category
function displayComments(){
  const uni=uniSelect.value;
  const cat=document.getElementById("category").value;
  const div=document.getElementById("comments"); div.innerHTML="";
  if(!uni||!cat) return;
  const filtered=comments.filter(c=>c.uni===uni && c.cat===cat);
  filtered.forEach((c,i)=>{
    const el=document.createElement("div"); el.className="comment";
    el.innerHTML=`<div class="comment-header">${c.uni} | ${c.cat} | Rating: ${c.rating}</div>
                  <div>${c.comment}</div>
                  <div class="comment-email">${c.email}</div>
                  <div class="reactions">
                    <button onclick="react(${i},'like')">üëç ${c.likes}</button>
                    <button onclick="react(${i},'dislike')">üëé ${c.dislikes}</button>
                  </div>`;
    div.appendChild(el);
  });
  updateChart(uni);
}

// Reaction system (once per user)
function react(i,type){
  const email=document.getElementById("email").value||"anon_"+i;
  const key=email+"_"+i;
  if(reacted[key]){alert("You can react only once per comment."); return;}
  reacted[key]=true;
  if(type==="like") comments[i].likes++;
  else comments[i].dislikes++;
  displayComments();
}

// Chart.js analytics
let chart;
function updateChart(uni){
  const ctx=document.getElementById("analyticsChart").getContext("2d");
  const categories=["Academics","Courses","Professors","Sports","Environment","Security","Facilities","Administration","Support","Other"];
  const dataCounts=categories.map(cat=>comments.filter(c=>c.uni===uni && c.cat===cat).length);
  const avgRatings=categories.map(cat=>{
    const c=comments.filter(c=>c.uni===uni && c.cat===cat && c.rating>0);
    if(c.length===0) return 0;
    return (c.reduce((sum,v)=>sum+v.rating,0)/c.length).toFixed(2);
  });
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:'bar',
    data:{
      labels:categories,
      datasets:[
        {label:'Comments Count', data:dataCounts, backgroundColor:'rgba(106,27,154,0.7)'},
        {label:'Average Rating', data:avgRatings, backgroundColor:'rgba(109,213,250,0.7)'}
      ]
    },
    options:{
      responsive:true,
      scales:{ y:{ beginAtZero:true } }
    }
  });
}
</script>
</body>
</html>
