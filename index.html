<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Event Poster Generator — v2</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:linear-gradient(135deg,#cfe9ff 0%,#e8d6ff 100%);--card:#fff;--accent:#6366f1;--radius:14px;font-family:Inter,system-ui,Arial}
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;background:var(--bg);font-family:var(--font-family);color:#0f172a}
    .app{max-width:1280px;margin:18px auto;padding:14px;display:grid;grid-template-columns:320px 1fr 320px;gap:14px}
    .panel{background:var(--card);border-radius:var(--radius);padding:12px;box-shadow:0 10px 30px rgba(12,15,30,.06)}
    h1{margin:6px 0 12px;font-size:18px}
    label{font-size:13px;color:#374151}
    input[type=text],input[type=file],select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef;margin-top:6px}
    textarea{min-height:72px}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,#6366f1,#8b5cf6);color:white;border:none;cursor:pointer}
    .muted{background:transparent;border:1px solid #edf2f7;padding:8px;border-radius:8px}
    .templates{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .tpl{width:100%;height:80px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid rgba(0,0,0,.06)}
    /* Canvas preview */
    .canvas-wrap{display:flex;flex-direction:column;align-items:center;gap:8px}
    #posterCanvas{background:#fff;border-radius:12px;box-shadow:0 14px 40px rgba(12,15,30,0.12)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .small{font-size:13px;color:#6b7280}
    .elements-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .element-row{display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;border:1px solid #f1f5f9}
    .row-actions{margin-left:auto;display:flex;gap:6px}
    /* Responsive */
    @media(max-width:1100px){.app{grid-template-columns:1fr;}}
    /* mobile collapse bar */
    .collapse-toggle{display:none}
    @media(max-width:700px){.collapse-toggle{display:block;margin-bottom:10px}}
  </style>
</head>
<body>
  <div class="app">
    <!-- Left: Inputs & Templates -->
    <aside class="panel">
      <h1>Create Poster</h1>
      <div class="small">Enter event details → pick a template → customize → export.</div><div style="margin-top:12px">
    <label>Event Name</label>
    <input id="eventName" type="text" placeholder="Community Jazz Night" value="Community Jazz Night">
    <label style="margin-top:8px">Date & Time</label>
    <input id="eventDate" type="datetime-local">
    <label style="margin-top:8px">Location</label>
    <input id="eventLocation" type="text" placeholder="Town Hall, Johannesburg">
    <label style="margin-top:8px">Event Type</label>
    <select id="eventType"><option>Concert</option><option>Wedding</option><option>Birthday</option><option>Sale</option><option>Workshop</option><option>Other</option></select>
    <label style="margin-top:8px">Short Description</label>
    <textarea id="eventDesc">An evening of live jazz and local food stalls.</textarea>

    <label style="margin-top:8px">Upload Images</label>
    <input id="imageUpload" type="file" accept="image/*" multiple>

    <label style="margin-top:8px">QR Code Link</label>
    <input id="qrLink" type="text" placeholder="https://... (optional)">

    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="genTemplates" class="btn">Suggest Templates</button>
      <button id="addTextBtn" class="muted">+ Add Text</button>
    </div>

    <div style="margin-top:12px">
      <div class="small">Templates</div>
      <div id="templates" class="templates">
        <!-- templates go here -->
      </div>
    </div>
  </div>

</aside>

<!-- Middle: Canvas and quick editor -->
<main class="panel">
  <div style="display:flex;align-items:center;justify-content:space-between">
    <h1>Preview & Editor</h1>
    <div class="small">Tip: drag elements on the poster to move them. Tap on an element to select.</div>
  </div>

  <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start">
    <div class="canvas-wrap">
      <select id="sizeSelect" class="small">
        <option value="1080x1350">Instagram Post (1080×1350)</option>
        <option value="1080x1080">Instagram Square (1080×1080)</option>
        <option value="1080x1920">Story (1080×1920)</option>
        <option value="2480x3508">A4 Print (2480×3508)</option>
      </select>
      <canvas id="posterCanvas" width="1080" height="1350"></canvas>

      <div class="controls">
        <button id="downloadPng" class="btn">Download PNG</button>
        <button id="downloadPdf" class="btn">Download PDF</button>
        <button id="addQrBtn" class="muted">+ Add QR</button>
        <button id="clearBtn" class="muted">Clear Poster</button>
      </div>
    </div>

    <div style="flex:1;min-width:260px">
      <div class="panel" style="margin-bottom:10px">
        <div class="small">Selected Element</div>
        <div id="selInfo" style="margin-top:8px">None</div>
        <label style="margin-top:8px">Font size</label>
        <input id="selFontSize" type="range" min="12" max="160" value="36">
        <label style="margin-top:8px">Color</label>
        <input id="selColor" type="color" value="#111827">
        <label style="margin-top:8px">Opacity</label>
        <input id="selOpacity" type="range" min="0" max="1" step="0.05" value="1">
        <div style="display:flex;gap:8px;margin-top:8px"><button id="bringFront" class="muted">Bring Front</button><button id="sendBack" class="muted">Send Back</button></div>
        <div style="margin-top:8px;display:flex;gap:8px"><button id="deleteEl" class="muted">Delete</button><button id="duplicateEl" class="muted">Duplicate</button></div>
      </div>

      <div class="panel">
        <div class="small">Elements</div>
        <div id="elementsList" class="elements-list"></div>
      </div>
    </div>
  </div>
</main>

<!-- Right: Advanced settings & presets -->
<aside class="panel">
  <h1>Styles & Presets</h1>
  <div class="small">Quick presets to make posters look professional instantly.</div>

  <div style="margin-top:10px">
    <label>Background Color</label>
    <input id="bgColor" type="color" value="#ffffff">
    <label style="margin-top:8px">Accent Color</label>
    <input id="accentColor" type="color" value="#6366f1">
    <label style="margin-top:8px">Typography Pair</label>
    <select id="fontPreset">
      <option value="Inter, sans-serif">Modern Sans</option>
      <option value="Playfair Display, serif">Elegant Serif</option>
      <option value="'Brush Script MT',cursive">Handwritten</option>
    </select>

    <div style="margin-top:12px">
      <div class="small">Template Presets</div>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
        <button class="muted" data-preset="wedding">Wedding Preset</button>
        <button class="muted" data-preset="sale">Sale / Promotion</button>
        <button class="muted" data-preset="party">Birthday / Party</button>
      </div>
    </div>

  </div>
</aside>

  </div>  <!-- Libraries -->  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>  <script>
    // State
    const canvas = document.getElementById('posterCanvas');
    const ctx = canvas.getContext('2d');
    let elements = []; // {id,type,x,y,w,h, text,font,size,color,alpha,src}
    let selected = null;
    let imagesCache = {}; // id -> Image object

    // Helpers
    const uid = ()=>Math.random().toString(36).slice(2,9);
    function setCanvasSize(w,h){
      canvas.width = w; canvas.height = h; render();
    }

    // Initialize size selector
    const sizeSelect = document.getElementById('sizeSelect');
    sizeSelect.addEventListener('change', ()=>{
      const [w,h] = sizeSelect.value.split('x').map(Number); setCanvasSize(w,h);
    });
    // set default
    (function(){const [w,h]=sizeSelect.value.split('x').map(Number); setCanvasSize(w,h);})();

    // Add templates (starter)
    const templates = [
      {id:'minimal',name:'Minimal',bg:'#ffffff',accent:'#6366f1',font:'Inter, sans-serif',layout:()=>{
          elements = [];
          elements.push({id:uid(),type:'text',text:document.getElementById('eventName').value,font:'700 72px Inter, sans-serif',x:canvas.width/2,y:160,align:'center',color:'#111827',alpha:1});
          elements.push({id:uid(),type:'text',text:document.getElementById('eventDesc').value,font:'400 28px Inter, sans-serif',x:canvas.width/2,y:240,align:'center',color:'#374151',alpha:1});
        }
      },
      {id:'bold',name:'Bold',bg:'#0f172a',accent:'#f97316',font:'Playfair Display, serif',layout:()=>{
          elements = [];
          elements.push({id:uid(),type:'rect',x:0,y:0,w:canvas.width*0.42,h:canvas.height,color:'#f97316',alpha:1});
          elements.push({id:uid(),type:'text',text:document.getElementById('eventName').value,font:'700 64px Playfair Display, serif',x:60,y:160,align:'left',color:'#fff',alpha:1});
          elements.push({id:uid(),type:'text',text:document.getElementById('eventDesc').value,font:'400 20px Playfair Display, serif',x:60,y:240,align:'left',color:'#fff',alpha:0.9});
        }
      },
      {id:'elegant',name:'Elegant',bg:'#fff7ed',accent:'#0ea5a4',font:"'Brush Script MT',cursive",layout:()=>{
          elements = [];
          elements.push({id:uid(),type:'text',text:document.getElementById('eventName').value,font:'700 72px Playfair Display, serif',x:80,y:140,align:'left',color:'#111827',alpha:1});
          elements.push({id:uid(),type:'text',text:document.getElementById('eventDesc').value,font:'400 20px Inter, sans-serif',x:80,y:220,align:'left',color:'#6b7280',alpha:1});
        }
      }
    ];

    // Render templates UI
    function renderTemplates(){
      const el = document.getElementById('templates'); el.innerHTML='';
      templates.forEach(t=>{
        const d = document.createElement('div'); d.className='tpl'; d.textContent=t.name; d.style.background=t.bg; d.style.color = (t.bg=='#0f172a' ? '#fff':'#111');
        d.onclick = ()=>{document.getElementById('bgColor').value = rgbToHex(t.bg); document.getElementById('accentColor').value = t.accent; document.getElementById('fontPreset').value = t.font; t.layout(); render(); refreshElementsList();}
        el.appendChild(d);
      });
    }
    renderTemplates();

    // Collect images from file input
    document.getElementById('imageUpload').addEventListener('change', ev=>{
      const files = Array.from(ev.target.files || []);
      files.forEach(f=>{
        const reader = new FileReader(); reader.onload = e=>{
          const img = new Image(); img.src = e.target.result; img.onload = ()=>{
            const elObj = {id:uid(),type:'image',src:img.src,x:80,y:300,w:Math.min(800,img.width),h:Math.min(600,img.height),alpha:1};
            elements.push(elObj); imagesCache[elObj.id]=img; render(); refreshElementsList();};
        }; reader.readAsDataURL(f);
      });
    });

    // Add Text button
    document.getElementById('addTextBtn').addEventListener('click', ()=>{
      const t = {id:uid(),type:'text',text:'New text',font:'700 40px Inter, sans-serif',x:120,y:120,align:'left',color:'#111827',alpha:1}; elements.push(t); render(); refreshElementsList(); selectElement(t.id);
    });

    // Add QR button
    document.getElementById('addQrBtn').addEventListener('click', ()=>{
      const link = document.getElementById('qrLink').value.trim(); if(!link){alert('Enter QR link first');return}
      // generate QR to temporary div
      const tmp = document.createElement('div'); tmp.style.display='none'; document.body.appendChild(tmp);
      const qr = new QRCode(tmp,{text:link,width:300,height:300,correctLevel:QRCode.CorrectLevel.H});
      setTimeout(()=>{const img = tmp.querySelector('img')||tmp.querySelector('canvas');
        let src = '';
        if(img){ if(img.tagName==='IMG') src = img.src; else src = img.toDataURL(); }
        document.body.removeChild(tmp);
        if(src){ const elObj = {id:uid(),type:'qr',src:src,x:canvas.width-320,y:canvas.height-320,w:240,h:240,alpha:1}; elements.push(elObj); render(); refreshElementsList(); }
      },300);
    });

    // Clear poster
    document.getElementById('clearBtn').addEventListener('click', ()=>{ if(confirm('Clear all elements?')){elements=[]; selected=null; render(); refreshElementsList();}});

    // Download PNG
    document.getElementById('downloadPng').addEventListener('click', async ()=>{
      // for print sizes we want high res: use canvas as is
      const dataUrl = canvas.toDataURL('image/png');
      const a = document.createElement('a'); a.href=dataUrl; a.download='poster.png'; a.click();
    });

    // Download PDF using jspdf
    document.getElementById('downloadPdf').addEventListener('click', async ()=>{
      const { jsPDF } = window.jspdf;
      const imgData = canvas.toDataURL('image/png');
      const pdf = new jsPDF({orientation: canvas.width>canvas.height?'landscape':'portrait',unit:'pt',format:[canvas.width,canvas.height]});
      pdf.addImage(imgData,'PNG',0,0,canvas.width,canvas.height);
      pdf.save('poster.pdf');
    });

    // Utility: convert hex to rgb? we need rgbToHex too
    function rgbToHex(hex){
      // ensure hex string like #rrggbb
      if(!hex) return '#ffffff';
      if(hex[0] !== '#') return hex;
      if(hex.length===4) return '#'+hex[1]+hex[1]+hex[2]+hex[2]+hex[3]+hex[3];
      return hex;
    }

    // Preset buttons
    document.querySelectorAll('[data-preset]').forEach(btn=>btn.addEventListener('click', (e)=>{
      const p = e.target.dataset.preset;
      if(p==='wedding'){ document.getElementById('bgColor').value='#fff7f3'; document.getElementById('accentColor').value='#c026d3'; document.getElementById('fontPreset').value='Playfair Display, serif'; }
      if(p==='sale'){ document.getElementById('bgColor').value='#fff'; document.getElementById('accentColor').value='#ef4444'; document.getElementById('fontPreset').value='Inter, sans-serif'; }
      if(p==='party'){ document.getElementById('bgColor').value='#f0f9ff'; document.getElementById('accentColor').value='#f97316'; document.getElementById('fontPreset').value='Inter, sans-serif'; }
      render();
    }));

    // Canvas rendering loop
    function render(){
      // background
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = document.getElementById('bgColor').value || '#ffffff'; ctx.fillRect(0,0,canvas.width,canvas.height);
      // draw elements in order
      for(let el of elements){
        ctx.globalAlpha = el.alpha===undefined?1:el.alpha;
        if(el.type==='rect'){
          ctx.fillStyle = el.color||'#000'; ctx.fillRect(el.x,el.y,el.w,el.h);
        } else if(el.type==='image' || el.type==='qr'){
          // draw cached img if exists
          const img = new Image(); img.src = el.src; try{ctx.drawImage(img,el.x,el.y,el.w,el.h);}catch(e){}
        } else if(el.type==='text'){
          // parse font weight & size
          ctx.fillStyle = el.color||'#111827'; ctx.font = el.font||'700 36px Inter, sans-serif';
          ctx.textAlign = el.align || 'left';
          const lines = (el.text||'').split('\n');
          let yy = el.y;
          for(let i=0;i<lines.length;i++){ ctx.fillText(lines[i], el.x, yy); yy += parseInt((el.font||'36px').match(/\d+/)||36) + 6; }
        }
        ctx.globalAlpha = 1;
      }
      // highlight selected
      if(selected){ ctx.strokeStyle='rgba(0,0,0,0.6)'; ctx.lineWidth=2; ctx.strokeRect(selected.x-6, selected.y-6, (selected.w||200)+12, (selected.h||50)+12); }
    }

    // Elements list UI
    function refreshElementsList(){
      const list = document.getElementById('elementsList'); list.innerHTML = '';
      elements.forEach(el=>{
        const row = document.createElement('div'); row.className='element-row'; row.textContent = el.type + ' — ' + (el.text ? (el.text.length>20?el.text.slice(0,20)+'...':el.text) : (el.src?'Image':''));
        const actions = document.createElement('div'); actions.className='row-actions';
        const selBtn = document.createElement('button'); selBtn.className='muted'; selBtn.textContent='Select'; selBtn.onclick = ()=>{ selectElement(el.id); };
        actions.appendChild(selBtn);
        row.appendChild(actions);
        list.appendChild(row);
      });
    }

    // Selection and editing
    function selectElement(id){ selected = elements.find(x=>x.id===id) || null; updateSelectedUI(); render(); }
    function updateSelectedUI(){ const info = document.getElementById('selInfo'); if(!selected){ info.textContent='None'; return; } info.textContent = selected.type + ' • id:'+selected.id; document.getElementById('selFontSize').value = parseInt((selected.font||'36px').match(/\d+/)||36); document.getElementById('selColor').value = selected.color || '#111827'; document.getElementById('selOpacity').value = selected.alpha || 1; }

    // UI control handlers
    document.getElementById('selFontSize').addEventListener('input', (e)=>{ if(!selected) return; const size = e.target.value; // keep font family
      if(selected.type==='text'){ const fam = (selected.font||'Inter, sans-serif').replace(/^.*?\s/, ''); selected.font = (selected.font && selected.font.includes('700') ? '700 '+size+'px ' : '400 '+size+'px ') + (selected.font.split(' ').slice(-1)[0]||'Inter, sans-serif'); }
      render(); refreshElementsList(); updateSelectedUI(); });
    document.getElementById('selColor').addEventListener('change', (e)=>{ if(!selected) return; selected.color = e.target.value; render(); updateSelectedUI(); });
    document.getElementById('selOpacity').addEventListener('input', (e)=>{ if(!selected) return; selected.alpha = parseFloat(e.target.value); render(); updateSelectedUI(); });
    document.getElementById('bringFront').addEventListener('click', ()=>{ if(!selected) return; elements = elements.filter(el=>el.id!==selected.id); elements.push(selected); render(); refreshElementsList(); });
    document.getElementById('sendBack').addEventListener('click', ()=>{ if(!selected) return; elements = elements.filter(el=>el.id!==selected.id); elements.unshift(selected); render(); refreshElementsList(); });
    document.getElementById('deleteEl').addEventListener('click', ()=>{ if(!selected) return; elements = elements.filter(el=>el.id!==selected.id); selected=null; render(); refreshElementsList(); updateSelectedUI(); });
    document.getElementById('duplicateEl').addEventListener('click', ()=>{ if(!selected) return; const copy = JSON.parse(JSON.stringify(selected)); copy.id = uid(); copy.x += 20; copy.y += 20; elements.push(copy); render(); refreshElementsList(); });

    // Canvas drag & select
    let dragging = false; let dragOffset = {x:0,y:0};
    canvas.addEventListener('mousedown', e=>{ const pos = getPointerPos(e); const el = getElementAtPos(pos); if(el){ selectElement(el.id); dragging = true; dragOffset.x = pos.x - el.x; dragOffset.y = pos.y - el.y; } else { selected = null; updateSelectedUI(); render(); } });
    window.addEventListener('mousemove', e=>{ if(!dragging || !selected) return; const pos = getPointerPos(e); selected.x = pos.x - dragOffset.x; selected.y = pos.y - dragOffset.y; render(); updateSelectedUI(); refreshElementsList(); });
    window.addEventListener('mouseup', e=>{ dragging = false; });

    // Touch support
    canvas.addEventListener('touchstart', e=>{ const pos = getPointerPos(e.touches[0]); const el = getElementAtPos(pos); if(el){ selectElement(el.id); dragging = true; dragOffset.x = pos.x - el.x; dragOffset.y = pos.y - el.y; } });
    window.addEventListener('touchmove', e=>{ if(!dragging || !selected) return; const pos = getPointerPos(e.touches[0]); selected.x = pos.x - dragOffset.x; selected.y = pos.y - dragOffset.y; render(); updateSelectedUI(); refreshElementsList(); });
    window.addEventListener('touchend', e=>{ dragging = false; });

    function getPointerPos(e){ const rect = canvas.getBoundingClientRect(); return { x: (e.clientX - rect.left) * (canvas.width/rect.width), y: (e.clientY - rect.top) * (canvas.height/rect.height) }; }
    function getElementAtPos(pos){ for(let i=elements.length-1;i>=0;i--){ const el = elements[i]; const w = el.w||200; const h = el.h||50; if(pos.x >= el.x && pos.x <= el.x + w && pos.y >= el.y && pos.y <= el.y + h){ return el; } } return null; }

    // Refresh loop just in case
    function loop(){ render(); requestAnimationFrame(loop); }
    loop();

    // Helper: refresh elements list initially
    refreshElementsList();

    // Download as high-res using html2canvas (for very large sizes), fallback to canvas
    document.getElementById('downloadPng').addEventListener('click', async ()=>{
      // If canvas is already poster size (A4 large) use that, else use html2canvas to render DOM? We'll use canvas directly since we render everything there.
      const dataUrl = canvas.toDataURL('image/png'); const a=document.createElement('a'); a.href=dataUrl; a.download='poster.png'; a.click();
    });

    // Utility: convert hex to rgb string
    function hexToRgb(hex){ hex = hex.replace('#',''); if(hex.length===3) hex = hex.split('').map(c=>c+c).join(''); const bigint = parseInt(hex,16); return [(bigint>>16)&255,(bigint>>8)&255, bigint&255]; }

    // Update event name/desc live when templates used
    document.getElementById('genTemplates').addEventListener('click', ()=>{ renderTemplates(); templates.forEach(t=>{ /* nothing */ }); alert('Pick a template on the left. Templates will use your event details.'); });

    // When user changes bg/accent/fontPreset, re-render
    document.getElementById('bgColor').addEventListener('change', render);
    document.getElementById('accentColor').addEventListener('change', render);
    document.getElementById('fontPreset').addEventListener('change', render);

    // small helper to convert named color to hex
    function componentToHex(c) { var hex = c.toString(16); return hex.length == 1 ? '0' + hex : hex; }

    // initial render
    render();

  </script></body>
</html>
