<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Browse Hustlers ‚Äî FindMyHustle</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1: #4b006e; /* purple */
    --bg2: #06112a; /* dark blue */
    --card-bg: rgba(255,255,255,0.98);
    --muted: #cbd5e1;
    --accent: #8b5cf6;
    --accent-dark: #3b82f6;
    --glass: rgba(255,255,255,0.06);
    --radius: 14px;
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: "Poppins", Arial, sans-serif;
    background: linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 100%);
    color: #e6eef9;
    -webkit-font-smoothing:antialiased;
    padding: 20px;
  }

  header {
    max-width: 980px;
    margin: 0 auto 18px;
    text-align: center;
  }
  header h1 {
    margin: 0;
    font-size: 24px;
    color: #fff;
    font-weight: 600;
  }
  header p {
    margin:6px 0 0;
    color: var(--muted);
    font-size: 14px;
  }

  .controls {
    max-width: 980px;
    margin: 0 auto 18px;
    display:flex;
    gap:12px;
    align-items:center;
    flex-wrap:wrap;
  }

  .select {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 10px;
    display:flex;
    gap:8px;
    align-items:center;
    box-shadow: 0 8px 24px rgba(2,6,23,0.18);
    color: #04243a;
  }

  .select label {
    margin-right:8px;
    font-weight:600;
    color:#07203a;
    font-size:13px;
  }

  select {
    padding:8px 10px;
    border-radius:8px;
    border:1px solid #e6eef6;
    font-size:14px;
    outline:none;
  }

  .grid {
    max-width: 980px;
    margin: 0 auto;
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:18px;
  }

  @media (max-width:980px){
    .grid { grid-template-columns: repeat(2, 1fr); }
  }
  @media (max-width:640px){
    .grid { grid-template-columns: 1fr; }
    .controls { flex-direction: column; align-items: stretch; }
  }

  .card {
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: 0 12px 30px rgba(2,6,23,0.32);
    transition: transform .18s ease, box-shadow .18s ease;
    border: 1px solid rgba(255,255,255,0.04);
  }
  .card:hover { transform: translateY(-6px); box-shadow: 0 20px 40px rgba(2,6,23,0.45); }

  .card .images {
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:4px;
    height:180px;
  }
  .card .images img {
    width:100%;
    height:180px;
    object-fit:cover;
    display:block;
    cursor:zoom-in;
    transition: transform .18s ease;
  }
  .card .images img:hover { transform: scale(1.03); }

  .card .content {
    padding:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  }

  .meta-line {
    display:flex;
    justify-content:space-between;
    gap:8px;
    align-items:center;
  }

  .name {
    font-weight:700;
    color: #fff;
    font-size:15px;
  }
  .skill {
    font-size:13px;
    color: var(--muted);
    font-weight:600;
  }
  .location {
    margin-top:8px;
    font-size:13px;
    color:var(--muted);
  }

  .contact {
    margin-top:10px;
    display:flex;
    gap:8px;
    align-items:center;
    flex-wrap:wrap;
  }

  .pill {
    background: rgba(255,255,255,0.04);
    padding:6px 8px;
    border-radius: 999px;
    color: var(--muted);
    font-weight:600;
    font-size:13px;
    border:1px solid rgba(255,255,255,0.03);
  }

  .view-btn {
    margin-top:10px;
    display:inline-block;
    background: linear-gradient(90deg,var(--accent),var(--accent-dark));
    color:white;
    padding:8px 12px;
    border-radius:8px;
    font-weight:700;
    text-decoration:none;
    cursor:pointer;
    border:none;
  }

  .no-results {
    max-width:980px;
    margin:60px auto;
    text-align:center;
    color:var(--muted);
    font-size:16px;
  }

  /* Lightbox */
  .lightbox {
    position:fixed;
    inset:0;
    display:none;
    justify-content:center;
    align-items:center;
    background: rgba(2,6,23,0.8);
    z-index:120;
    padding:18px;
  }
  .lightbox.open { display:flex; }
  .lightbox .box {
    max-width:1000px;
    width:100%;
    background:#fff;
    border-radius:12px;
    overflow:hidden;
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:8px;
  }
  .lightbox img { width:100%; height:80vh; object-fit:contain; background:#000; }
  .lightbox .info {
    padding:12px;
    background:#fff;
    color:#04243a;
  }
  .lightbox .close {
    position:absolute;
    top:18px;
    right:20px;
    background:transparent;
    color:#fff;
    border:2px solid rgba(255,255,255,0.25);
    padding:8px 10px;
    border-radius:8px;
    font-weight:700;
    cursor:pointer;
  }

  /* small helper */
  .muted { color: var(--muted); }
</style>
</head>
<body>
  <header>
    <h1>Browse Hustlers</h1>
    <p>Only verified hustlers are shown. Filter by province or skill to find local talent.</p>
  </header>

  <div class="controls" aria-hidden="false">
    <div class="select">
      <label for="filterSkill">Skill</label>
      <select id="filterSkill">
        <option value="all">All Skills</option>
      </select>
    </div>

    <div class="select">
      <label for="filterProvince">Province</label>
      <select id="filterProvince">
        <option value="all">All Provinces</option>
      </select>
    </div>

    <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
      <div class="select" style="padding:8px 12px;">
        <label style="margin-right:8px; font-weight:600; color:#07203a;">Results</label>
        <span id="resultCount" style="font-weight:700; color:#fff;">0</span>
      </div>
    </div>
  </div>

  <main id="listArea" class="grid" aria-live="polite"></main>

  <div id="noResults" class="no-results" style="display:none;">No hustlers found. Try clearing filters.</div>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" role="dialog" aria-hidden="true">
    <button class="close" id="closeLightbox">Close ‚úï</button>
    <div class="box">
      <img id="lightImg1" src="" alt="Image 1">
      <img id="lightImg2" src="" alt="Image 2">
      <div class="info" style="grid-column: 1 / -1">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div>
            <div id="lbName" style="font-weight:800; font-size:18px; color:#04243a"></div>
            <div id="lbSkill" class="muted" style="margin-top:6px"></div>
          </div>
          <div id="lbLocation" class="muted" style="font-weight:700"></div>
        </div>

        <div style="margin-top:10px" id="lbContacts" class="muted"></div>
        <div style="margin-top:8px; color:#07203a; font-weight:700" id="lbDate"></div>
      </div>
    </div>
  </div>

<script>
  // ================= CONFIG =================
  const API_URL = "https://script.google.com/macros/s/AKfycbzUaUmJe5BXagtPTWpP0FwQe9_ngrJL5_BBraTF3pedVbmFQ1xzXh1UOonUSzWOLJ8oNA/exec";

  // Skill and Province lists must match exactly the upload.html values
  const SKILLS = [
    "Tailor / Sewing","Barber / Haircut","Hairstylist / Braiding","Makeup Artist","Nail Technician",
    "Photographer","Videographer","Graphic Designer","Web Developer","Mobile Phone Repair","Computer Technician",
    "Baker / Pastry","Chef / Catering","Street Food Vendor","Carpenter","Painter (House/Signs)","Plumber",
    "Electrician","Mechanic","Driver / Delivery","Cleaner / Domestic","Gardener / Landscaping","Tutor / Academic Coach",
    "Fitness Trainer","DJ / Musician","Event Planner","Jewellery / Beading","Shoe Repair","Tailor (Alterations)","Handyman / General Repairs","Other"
  ];

  const PROVINCES = [
    "Eastern Cape","Free State","Gauteng","KwaZulu-Natal","Limpopo","Mpumalanga","Northern Cape","North West","Western Cape","Other / Remote"
  ];

  // ================= UI ELEMENTS =================
  const listArea = document.getElementById('listArea');
  const noResults = document.getElementById('noResults');
  const filterSkill = document.getElementById('filterSkill');
  const filterProvince = document.getElementById('filterProvince');
  const resultCount = document.getElementById('resultCount');

  // Lightbox elements
  const lightbox = document.getElementById('lightbox');
  const closeLightbox = document.getElementById('closeLightbox');
  const lightImg1 = document.getElementById('lightImg1');
  const lightImg2 = document.getElementById('lightImg2');
  const lbName = document.getElementById('lbName');
  const lbSkill = document.getElementById('lbSkill');
  const lbLocation = document.getElementById('lbLocation');
  const lbContacts = document.getElementById('lbContacts');
  const lbDate = document.getElementById('lbDate');

  // Populate filter selects
  function populateFilters(){
    SKILLS.forEach(s => {
      const opt = document.createElement('option');
      opt.value = s;
      opt.textContent = s;
      filterSkill.appendChild(opt);
    });
    PROVINCES.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p;
      opt.textContent = p;
      filterProvince.appendChild(opt);
    });
  }

  // Fetch verified hustlers from API
  async function fetchHustlers(){
    try {
      const res = await fetch(API_URL);
      if(!res.ok) throw new Error('Network response not ok');
      const data = await res.json();
      // Ensure it's an array. doGet already filters but double-check Verified === 'Yes'
      return Array.isArray(data) ? data.filter(item => String((item.Verified||'')).toLowerCase() === 'yes') : [];
    } catch (err) {
      console.error('Fetch error', err);
      return [];
    }
  }

  // Render cards
  function renderCards(items){
    listArea.innerHTML = '';
    if(items.length === 0){
      noResults.style.display = 'block';
      resultCount.textContent = '0';
      return;
    }
    noResults.style.display = 'none';
    resultCount.textContent = String(items.length);

    items.forEach(item => {
      const image1 = item.Image1 || '';
      const image2 = item.Image2 || image1 || '';
      const name = item.Name || 'Unknown';
      const skill = item.Skill || '';
      const province = item.Province || '';
      const city = item.City || '';
      const phone = item.Phone || '';
      const email = item.Email || '';
      const date = item.Date || '';

      const card = document.createElement('article');
      card.className = 'card';
      card.innerHTML = `
        <div class="images">
          <img loading="lazy" src="${escapeHtml(image1)}" alt="${escapeHtml(name)} image 1" onerror="this.onerror=null;this.src='data:image/svg+xml;utf8,<svg xmlns=\\'http://www.w3.org/2000/svg\\' width=400 height=300><rect fill=%23f3f7fa width=100% height=100%/><text x=50% y=50% alignment-baseline=middle text-anchor=middle fill=%23999 font-size=16>Image not found</text></svg>'">
          <img loading="lazy" src="${escapeHtml(image2)}" alt="${escapeHtml(name)} image 2" onerror="this.onerror=null;this.src='data:image/svg+xml;utf8,<svg xmlns=\\'http://www.w3.org/2000/svg\\' width=400 height=300><rect fill=%23f3f7fa width=100% height=100%/><text x=50% y=50% alignment-baseline=middle text-anchor=middle fill=%23999 font-size=16>Image not found</text></svg>'">
        </div>

        <div class="content">
          <div class="meta-line">
            <div>
              <div class="name">${escapeHtml(name)}</div>
              <div class="skill">${escapeHtml(skill)}</div>
            </div>
            <div class="pill">${escapeHtml(province)}</div>
          </div>

          <div class="location">${escapeHtml(city)}</div>

          <div class="contact">
            ${ phone ? `<div class="pill">üìû ${escapeHtml(phone)}</div>` : '' }
            ${ email ? `<div class="pill">‚úâÔ∏è ${escapeHtml(email)}</div>` : '' }
            <div style="margin-left:auto"><button class="view-btn" type="button">View</button></div>
          </div>
        </div>
      `;

      // view button opens lightbox with large images and details
      const viewBtn = card.querySelector('.view-btn');
      viewBtn.addEventListener('click', () => openLightbox({image1, image2, name, skill, province, city, phone, email, date}));

      // clicking any image also opens lightbox
      card.querySelectorAll('.images img').forEach(img => img.addEventListener('click', () => openLightbox({image1, image2, name, skill, province, city, phone, email, date})));

      listArea.appendChild(card);
    });
  }

  // Filtering logic
  function applyFilters(allItems){
    const skill = filterSkill.value;
    const province = filterProvince.value;

    let filtered = allItems.slice();

    if(skill && skill !== 'all'){
      filtered = filtered.filter(it => (it.Skill || '') === skill);
    }
    if(province && province !== 'all'){
      filtered = filtered.filter(it => (it.Province || '') === province);
    }

    renderCards(filtered);
  }

  // Lightbox open
  function openLightbox(data){
    lightImg1.src = data.image1 || '';
    lightImg2.src = data.image2 || data.image1 || '';
    lbName.textContent = data.name || '';
    lbSkill.textContent = data.skill || '';
    lbLocation.textContent = (data.city ? data.city + ', ' : '') + (data.province || '');
    lbContacts.innerHTML = (data.phone ? 'Phone: ' + escapeHtml(data.phone) + ' ' : '') + (data.email ? ' ‚Ä¢ Email: ' + escapeHtml(data.email) : '');
    lbDate.textContent = data.date ? 'Submitted: ' + escapeHtml(data.date) : '';
    lightbox.classList.add('open');
    lightbox.setAttribute('aria-hidden','false');
    window.scrollTo({top:0, behavior:'smooth'});
  }

  function closeLightboxFn(){
    lightbox.classList.remove('open');
    lightbox.setAttribute('aria-hidden','true');
    lightImg1.src = '';
    lightImg2.src = '';
  }
  closeLightbox.addEventListener('click', closeLightboxFn);
  lightbox.addEventListener('click', (e)=> { if(e.target === lightbox) closeLightboxFn(); });

  // Escape helper
  function escapeHtml(str){
    if(!str) return '';
    return String(str)
      .replace(/&/g,'&amp;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;')
      .replace(/"/g,'&quot;')
      .replace(/'/g,'&#039;');
  }

  // Init: populate filters, fetch items, wire events
  (async function init(){
    populateFilters();
    const allItems = await fetchHustlers();
    // Save original list for re-filtering
    window.__ALL_HUSTLERS__ = allItems;
    applyFilters(allItems);

    filterSkill.addEventListener('change', ()=> applyFilters(allItems));
    filterProvince.addEventListener('change', ()=> applyFilters(allItems));
  })();
</script>
</body>
  </html>
